<!DOCTYPE html>
<html lang="en-GB">
   <head>
      <meta charset="utf-8" />
      <meta name="description" content="Colour vision deficiency friendly palettes">
      <meta name="keywords" content="accessibility, presentation, blog">
      <meta name="author" content="Matthew Deeprose">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Colour vision deficiency friendly palettes</title>
      <link rel="stylesheet" id="lightCSS" href="light.css" media="(prefers-color-scheme: light)">
      <link rel="stylesheet" id="mainCSS" href="main.css" media="all">
      <link rel="stylesheet" id="darkCSS" href="dark.css" media="(prefers-color-scheme: dark)">
      <link rel="stylesheet" id="printCSS" href="print.css" media="print">
      <meta property="og:title" content="Colour vision deficiency friendly palettes - Matthew Deeprose">
      <meta property="og:description" content="The following colour scheme are taken from the document, 'Colorblind Safe Color Schemes', produced by Alexandra Phillips at the NCEAS Science Communication Resource Corner, with the exception of the HarryHelsing Palette which was posted in on Reddit: 'thoughts on this five colour palette for a video game'?.">
      <meta property="og:image" content="https://matthewdeeprose.github.io/cvdp-43.png">
	  <meta property="og:image:width" content="2500" />
	  <meta property="og:image:height" content="1306" />
      <meta property="og:image:alt" content="">
      <meta property="og:locale" content="en_GB">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://matthewdeeprose.github.io/CVDP.html">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="theme-color" content="#231F20" media="(prefers-color-scheme: dark)">
      <meta name="theme-color" content="#FFFFF4" media="(prefers-color-scheme: light)">
      <link rel="icon" href="favicon.ico">
      <link rel="alternate" type="application/rss+xml" title="RSS Feed for matthewdeeprose.github.io" href="https://matthewdeeprose.github.io/feed.rss">
      <link rel="icon" href="favicon.svg" type="image/svg+xml">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="Colour vision deficiency friendly palettes - Matthew Deeprose" />
      <meta name="twitter:description" content=""/>
      <meta name="twitter:creator" content="@VLEguru"/>
      <meta name="twitter:site" content="@VLEguru"/>
      <meta name="twitter:image" content="https://matthewdeeprose.github.io/cvdp-43.png"/>
      <meta name="twitter:image:alt" content=""/>
      <meta name="twitter:card" content="summary_large_image"/>
	      <style>


      *.page-wrap>* {
        grid-column: 1/-1 !important;
        grid-row: auto !important;
      } 
	  
	  /* Filters */

.protanopia {
    -webkit-filter: url(#protanopia);
    -moz-filter: url(#protanopia);
    -ms-filter: url(#protanopia);
    -o-filter: url(#protanopia);
    filter: url(#protanopia);
}

.deuteranopia {
    -webkit-filter: url(#deuteranopia);
    -moz-filter: url(#deuteranopia);
    -ms-filter: url(#deuteranopia);
    -o-filter: url(#deuteranopia);
    filter: url(#deuteranopia);
}

.tritanopia {
    -webkit-filter: url(#tritanopia);
    -moz-filter: url(#tritanopia);
    -ms-filter: url(#tritanopia);
    -o-filter: url(#tritanopia);
    filter: url(#tritanopia);
}




    </style>
	
    <style>
        .color-input, .palette-controls, .button-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
/*        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        } */
        .color-cell {
            width: 100px;
            height: 30px;
        }
        #fileInput {
            display: none;
        }
        #paletteName {
            flex-grow: 1;
        }
		.palette-controls {
	clear: left;
	display: flow-root;
}

.userTable th[scope=row] {
    text-transform: uppercase;;
}


    </style>
   </head>
   <body>
      <div class="page-wrap" id="start">
         <a class="skip-link" id="skipToContent" href='#main'>Skip to content</a>
         <header class="page-header">
            <div id="banner">
               <div id="logo">
                  <button id="modeToggle" aria-label="Change between light and dark theme" aria-pressed="false" onclick="toggle(this.id);">
                     <svg id="logoSVG" height="45" viewBox="0 0 21 21" width="45" xmlns="http://www.w3.org/2000/svg" aria-labelledby="svgTitle svgDesc" role="img">
                        <title id="svgTitle">Change theme</title>
                        <desc id="svgDesc">Select to switch to light theme</desc>
                        <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 1)">
                           <path d="m6.5 17.5h4"/>
                           <path d="m8.5 4c2.4852814 0 4.5 2.01471863 4.5 4.5 0 1.7663751-1.017722 3.2950485-2.4987786 4.031633l-.0012214.968367c0 1.1045695-.8954305 2-2 2s-2-.8954305-2-2l-.00021218-.9678653c-1.48160351-.7363918-2.49978782-2.2653584-2.49978782-4.0321347 0-2.48528137 2.01471863-4.5 4.5-4.5z"/>
                           <path d="m8.5 1.5v-1"/>
                           <path d="m13.5 3.5 1-1"/>
                           <path d="m2.5 3.5 1-1" transform="matrix(-1 0 0 1 6 0)"/>
                           <path d="m13.5 13.5 1-1" transform="matrix(1 0 0 -1 0 26)"/>
                           <path d="m2.5 13.5 1-1" transform="matrix(-1 0 0 -1 6 26)"/>
                           <path d="m1.5 7.5h-1"/>
                           <path d="m16.5 7.5h-1"/>
                        </g>
                     </svg>
                     <svg id="logoSVG-Off" height="45" viewBox="0 0 21 21" width="45" xmlns="http://www.w3.org/2000/svg" aria-labelledby="svgTitleX svgDescX">
                        <title id="svgTitleX">Change theme</title>
                        <desc id="svgDescX">Select to switch to dark theme</desc>
                        <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(6 5)">
                           <path d="m2.5 13.5h4"/>
                           <path d="m4.5 0c2.48528137 0 4.5 2.01471863 4.5 4.5 0 1.76637512-1.01772197 3.29504854-2.49877863 4.03163297l-.00122137.96836703c0 1.1045695-.8954305 2-2 2s-2-.8954305-2-2l-.00021218-.96786527c-1.48160351-.73639182-2.49978782-2.26535843-2.49978782-4.03213473 0-2.48528137 2.01471863-4.5 4.5-4.5z"/>
                        </g>
                     </svg>
                  </button>
               </div>
               <span role="alert" class="hidden" aria-live="polite" id="lightDark"></span>
               <div id="titleLink">Matthew Deeprose</div>
            </div>
         </header>
         <div id="main-navigation" class="page-nav">
            <nav aria-label="Main menu" class="topnav" id="myTopnav">
               <button id="menu" aria-controls="myTopnav" aria-labelledby="myTopnav" aria-expanded="false" class="icon"  aria-haspopup="menu" onclick="menuAction()">
                  <span id="hamburger">
                     <svg id="hamSVG" viewBox="0 0 100 80" width="20" height="20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="img">
                        <title id="hamSVGTitle">Menu</title>
                        <desc id="hamSVGDesc">Select to expand or collapse the menu</desc>
                        <rect width="100" height="20"></rect>
                        <rect y="30" width="100" height="20"></rect>
                        <rect y="60" width="100" height="20"></rect>
                     </svg>
                  </span>
                  <span id="arrow">
                     <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" focusable="false">
                        <title id="arrowSVGTitle">Menu</title>
                        <desc id="arrowSVGDesc">Select to expand or collapse the menu</desc>
                        <g stroke-width="4"  stroke-linejoin="round" stroke-linecap="round" stroke="currentColor" fill-rule="evenodd" fill="none">
                           <path  d="m7.499,6.497l-3.999,4.002l4,4.001"/>
                           <path  d="m16.5,10.5l-13,0"/>
                        </g>
                     </svg>
                  </span>
               </button>
               <a id="homeMenu" href="index.html">Home</a>
               <a href="presentations.html">Presentations</a>
               <a href="posts.html">Blog Posts</a>
               <a href="projects.html" aria-current="page" class="active">Projects</a>
               <a href="about.html">About</a>
            </nav>
         </div>
         <main class="page-main" id="main">
            <article class="standard">
               <h1 id="top">Colour vision deficiency friendly palettes</h1>
			   <section id="contentsSection">
			   
			   
			   			   <details id="contentDetails">
			               <summary class="Contents">
              <h2 id="Contents">Contents</h2>
            </summary>
				<ul id="index">
				</ul>
			</details>
			</section>
			<section id="introSection">
						   			   <details id="introdcutionDetails">
									   <summary>
			  <h2>Introduction</h2>
			              </summary>
<p>The following colour schemes are taken from the document, <a href="https://www.nceas.ucsb.edu/sites/default/files/2022-06/Colorblind%20Safe%20Color%20Schemes.pdf">"Colorblind Safe Color Schemes", produced by Alexandra Phillips at the NCEAS Science Communication Resource Corner, with the exception of the HarryHelsing Palette which was posted in on Reddit: <a href="https://www.reddit.com/r/ColorBlind/comments/1eo1aaq/thoughts_on_this_five_colour_palette_for_a_video/">thoughts on this five colour palette for a video game?</a>. I created a <a href="https://matthewdeeprose.github.io/cvdp.json">JSON dataset</a> for these colour schemes, which is used to generate the tables below.</p><p>Colour vision deficiency simulation is provided using the <a href="https://daltonlens.org/cvd-simulation-svg-filters/">Accurate SVG filters for color blindness simulation</a> by Nicolas Burrus.</p>

<h3>Want to create your own colour vision deficiency friendly palette?</h3>
<p>You can use the dropdown below to create your own palette. Adobe has built a tool for creating <a href="https://color.adobe.com/create/color-accessibility">colour vision deficiency friendly palettes that may help you</a>. If you make one that you would like to add to the standard selection below, let me know.</p>
			</details>
			</section>

			   
<section id ="customPaletteSection">			   
     <div id="multiPaletteManager">
	 <details id="paletteManagerDetails">
	 <summary>
        <h2>Creating your own Colour Palette (Beta)</h2>
		</summary>
        <div class="palette-controls">
		  <fieldset>
    <legend>Make your own palette</legend>
            <button id="createPalette">Create New Palette</button>
			<label id="paletteNameLabel" for="paletteName">Palette Name</label>
            <input type="text" id="paletteName">
  </fieldset>
		
		
				  <fieldset>
    <legend>Palette Controls</legend>
            <label id="paletteSelectLabel" for="paletteSelect">Select Palette</label>
			<select id="paletteSelect"></select>
            <button id="renamePalette">Rename Palette</button>
            <button id="deletePalette">Delete Palette</button>
  </fieldset>
		



        </div>


        <div class="button-container">
				  <fieldset>
    <legend>Save / Load / Import / Export your own palette</legend>

			<div id="localStorageButtons">
            <button id="savePalettes">Save Palettes to Browser Storage</button>
            <button id="loadPalettes">Load Palettes from Browser Storage</button>
			</div>
			<div id="externalStorageButtons">
            <button id="exportPalettes">Export Palettes</button>
            <button id="importPalettes">Import Palettes</button>
            <input type="file" id="fileInput" accept=".json">
			</div>
			  </fieldset>
        </div>
		 <div id="myMessage"><div id="myMessageIcon"></div><span id="pageMessage" aria-live="assertive" role="alert"></span>
			<button onclick="clearMessage();" class="clearMessageButton">Clear message</button>
			
			</div>
			
			        <div class="color-input">
		<fieldset>
		    <legend>Add colours to your custom palette</legend>

			<label id="colorPickerLabel" for="colorPicker">Pick Colour</label>
            <input type="color" id="colorPicker" class="color-swatch" value="#000000">
			<label id="colorHexLabel" for="colorHex">or enter hex code</label>
            <input type="text" id="colorHex" value="#000000">
            <button id="addColor">Add Colour to Palette</button>

			  </fieldset>
        </div>
			
			        <table id="userColorTable">
            <thead>
                <tr>
                    <th>Trichromacy</th>
                    <th>Protanopia</th>
                    <th>Deuteranopia</th>
                    <th>Tritanopia</th>
                    <th>Delete?</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
			</details>
    </div>
			   </section>
			   
			   
			   
			   <div id="insertHere">
			   </div>
			   
			   
			   
			   
			   
			   
			   
            </article>
			      <div id="panel">
         <button class="panelButton" onclick="topFunction()" id="myBtn">
            <svg id="svgUP" height="50" viewBox="0 0 21 21" width="50" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle2 svgDesc2">
               <title id="svgTitle2">Top.</title>
               <desc id="svgDesc2">Move to the top of the page.</desc>
               <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 2)">
                  <circle cx="8.5" cy="8.5" r="8"/>
                  <path d="m11.5 7.5-3-3-3 3"/>
                  <path d="m8.5 4.5v8"/>
               </g>
            </svg>
            <br />
            <span id="myBtnTop" class="panelLabel">Top</span>
         </button>
         <button class="panelButton" onclick="bottomFunction()" id="myBtn2">
            <svg id="svgDOWN" height="50" viewBox="0 0 21 21" width="50" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle3 svgDesc3">
               <title id="svgTitle3">Bottom.</title>
               <desc id="svgDesc3">Move to the bottom of the page.</desc>
               <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(3 2)">
                  <circle cx="8.5" cy="8.5" r="8"/>
                  <path d="m5.5 9.5 3 3 3-3"/>
                  <path d="m8.5 12.5v-8"/>
               </g>
            </svg>
            <br />
            <span id="myBtnBottom" class="panelLabel">Bottom</span>
         </button>
      </div>
         </main>

         <footer class="page-footer">
            <div id="RSS"><a id="rssA" href="feed.rss">RSS</a></div>
            <div id="SiteMap"><a href="siteMap.html">Site Map</a></div>
            <div id="AccessibilityFoot">
               <a href="Accessibility_Statement.html">Accessibility Statement</a>
            </div>
            <div id="twitterFoot">
               <a href="https://twitter.com/vleguru?ref_src=twsrc%5Etfw">Follow on Twitter</a>
            </div>
            <div id="YouTubeChannelFoot">
               <a href="https://www.youtube.com/channel/UCKypjo59GE79UEjoLtzKEtQ">YouTube Channel</a>
            </div>
            <div id="aboutCodePen"><a href="https://codepen.io/matthewdeeprose/">CodePen</a></div><p><div id="aboutFoot">
               <div id="CC">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA</a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">CVDP</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"><a href="https://www.linkedin.com/in/mattdeeprose/">Matthew Deeprose</a></span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
<p>To simulate CVD it uses <a href="https://daltonlens.org/cvd-simulation-svg-filters/">Accurate SVG filters for color blindness simulation</a> by Nicolas Burrus, released as "free and unencumbered software released into the public domain".</p></div>
         </p></footer>
      </div>
	  <svg style='height: 0; width: 0; padding: 0; margin: 0; line-height: 0;'>
  <!-- from https://daltonlens.org/cvd-simulation-svg-filters/ and https://github.com/DaltonLens/libDaltonLens/tree/master/svg -->
    <!-- Single matrix approximation of Viénot, Brettel & Mollon 1999 -->
    <filter id="protanopia" color-interpolation-filters="linearRGB">
        <feColorMatrix type="matrix" in="SourceGraphic" values="
            0.10889,0.89111,-0.00000,0,0
            0.10889,0.89111,0.00000,0,0
            0.00447,-0.00447,1.00000,0,0
            0,0,0,1,0"
        />
    </filter>

    <!-- Single matrix approximation of Viénot, Brettel & Mollon 1999 -->
    <filter id="deuteranopia" color-interpolation-filters="linearRGB">
        <feColorMatrix type="matrix" in="SourceGraphic" values="
            0.29031,0.70969,-0.00000,0,0
            0.29031,0.70969,-0.00000,0,0
            -0.02197,0.02197,1.00000,0,0
            0,0,0,1,0"
        />
    </filter>

    <!-- 
        Brettel, Viénot & Mollon 1997 algorithms with two projection planes.

        This is the only approach I know that is supposed to be reasonably
        accurate for tritanopia, the single matrix approaches are NOT accurate.
    -->
    <filter id="tritanopia" color-interpolation-filters="linearRGB">
        <!-- 
            Projection 1, with a special alpha that encodes the separation plane.
            If dot(rgb, n) > 0, then use projection 1, otherwise use projection 2.
            This is encoded in alpha by:
                - Applying a 1.0 factor on the source alpha so that 0 input alpha remains 0
                - Subtracting 0.2 so that negative values become < 0.8 and position values >= 0.8
                - It is important to normalize the factors to keep a good numerical accuracy
                  and to keep a large alpha threshold since the RGB values are then stored
                  premultiplied by alpha.
                - This assumes that negative values get clipped to 0, and positive
                  values clipped to 1, without overflowing, etc. Which seems to be the case
                  on all browsers.
          -->
        <feColorMatrix type="matrix" in="SourceGraphic" result="ProjectionOnPlane1" values="
            1.01354, 0.14268, -0.15622, 0, 0
            -0.01181, 0.87561, 0.13619, 0, 0
            0.07707, 0.81208, 0.11085, 0, 0
            7.92482, -5.66475, -2.26007, 1, -0.2"
        />
        <!-- 
            Binarize alpha. 5 values means the last chunk will start at 0.8.
            All the values below 0.8 will become 0 (correspond to the dot
            product with the separation plane being negative) and above will become 1
        -->        
        <feComponentTransfer in="ProjectionOnPlane1" result="ProjectionOnPlane1">
            <feFuncA type="discrete" tableValues="0 0 0 0 1"/>
        </feComponentTransfer>

        <feColorMatrix type="matrix" in="SourceGraphic" result="ProjectionOnPlane2" values="
            0.93337, 0.19999, -0.13336, 0, 0
            0.05809, 0.82565, 0.11626, 0, 0
            -0.37923, 1.13825, 0.24098, 0, 0
            0,0,0,1,0"
        />

        <!-- Uncomment the debug black matrix to see which pixels go to which plane -->
        <!-- <feColorMatrix type="matrix" in="SourceGraphic" result="ProjectionOnPlane2" values="0,0,0,0,0 0,0,0,0,0 0,0,0,0,0 0,0,0,1,0"/> -->

        <!-- Blend the two projections, picking one or the other depending on alpha. -->
        <feBlend in="ProjectionOnPlane1" in2="ProjectionOnPlane2" mode="normal"/>
    </filter>
</svg>
    <script>
	
	// Palette Editing 
	
	
// Wait for the DOM to be fully loaded before running the script
document.addEventListener('DOMContentLoaded', function() {
    // Get references to all the necessary DOM elements
    const colorPicker = document.getElementById('colorPicker');
    const colorHex = document.getElementById('colorHex');
    const addColorBtn = document.getElementById('addColor');
	const userColorTable = document.getElementById('userColorTable').getElementsByTagName('tbody')[0];
    const paletteSelect = document.getElementById('paletteSelect');
    const paletteName = document.getElementById('paletteName');
    const createPaletteBtn = document.getElementById('createPalette');
    const renamePaletteBtn = document.getElementById('renamePalette');
    const deletePaletteBtn = document.getElementById('deletePalette');
    const savePalettesBtn = document.getElementById('savePalettes');
    const loadPalettesBtn = document.getElementById('loadPalettes');
    const exportPalettesBtn = document.getElementById('exportPalettes');
    const importPalettesBtn = document.getElementById('importPalettes');
    const fileInput = document.getElementById('fileInput');

    // Initialize variables to store palettes and current palette
    let palettes = {};
    let currentPalette = '';

    // Synchronize color picker and hex input
    colorPicker.addEventListener('input', function() {
        colorHex.value = this.value;
    });

    colorHex.addEventListener('input', function() {
        colorPicker.value = this.value;
    });

// Function to validate hex color code
function isValidHexColor(color) {
    return /^#?[0-9A-F]{6}$/i.test(color);
}

// Function to add color to palette
function addColorToPalette() {
    if (currentPalette) {
        let colorValue = colorHex.value.trim();
        
        // Add # if it's missing
        if (colorValue.charAt(0) !== '#') {
            colorValue = '#' + colorValue;
        }
        
        // Validate the hex color code
        if (isValidHexColor(colorValue)) {
            addColor(colorValue);
            let addedColorCode = colorValue.toUpperCase();
            displayNotification(addedColorCode + ' added to palette.');
        } else {
            displayNotification('Error: Invalid hex color code. Please use the format #RRGGBB.');
        }
    } else {
        displayNotification('Please create or select a palette first.');
    }
}

// Get references to the input and button



// Add color to current palette when button is clicked
addColorBtn.addEventListener('click', addColorToPalette);

// Add color to current palette when Enter is pressed in the input field
colorHex.addEventListener('keyup', function(event) {
    if (event.key === 'Enter') {
        addColorToPalette();
    }
});

    // Create a new palette
    createPaletteBtn.addEventListener('click', function() {
        const name = paletteName.value.trim();
        if (name && !palettes[name]) {
            palettes[name] = [];
            currentPalette = name;
            updatePaletteSelect();
            renderTable();
            paletteName.value = '';
        } else {
            displayNotification('Please enter a unique palette name.');
        }
    });

    // Rename the current palette
    renamePaletteBtn.addEventListener('click', function() {
        const newName = paletteName.value.trim();
        if (currentPalette && newName && !palettes[newName]) {
            palettes[newName] = palettes[currentPalette];
            delete palettes[currentPalette];
            currentPalette = newName;
            updatePaletteSelect();
            paletteName.value = '';
        } else {
            displayNotification('Please select a palette and enter a unique new name.');
			document.getElementById('paletteName').focus();
        }
    });

    // Delete the current palette
    deletePaletteBtn.addEventListener('click', function() {
        if (currentPalette) {
            if (confirm(`Are you sure you want to delete the palette "${currentPalette}"?`)) {
                delete palettes[currentPalette];
                currentPalette = Object.keys(palettes)[0] || '';
                updatePaletteSelect();
                renderTable();
            }
        } else {
            displayNotification('Please select a palette to delete.');
        }
    });

    // Switch between palettes
    paletteSelect.addEventListener('change', function() {
        currentPalette = this.value;
        renderTable();
    });

    // Save all palettes to localStorage
    savePalettesBtn.addEventListener('click', function() {
        localStorage.setItem('colorPalettes', JSON.stringify(palettes));
        displayNotification('All palettes saved to LocalStorage!');
    });

    // Load palettes from localStorage
    loadPalettesBtn.addEventListener('click', function() {
        const savedPalettes = localStorage.getItem('colorPalettes');
        if (savedPalettes) {
            palettes = JSON.parse(savedPalettes);
            currentPalette = Object.keys(palettes)[0] || '';
            updatePaletteSelect();
            renderTable();
            displayNotification('Palettes loaded from LocalStorage!');
        } else {
            displayNotification('No saved palettes found in LocalStorage.');
        }
    });

    // Export all palettes to JSON file
    exportPalettesBtn.addEventListener('click', function() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(palettes));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "color_palettes.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    });

    // Import palettes from JSON file
    importPalettesBtn.addEventListener('click', function() {
        fileInput.click();
    });

    fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedPalettes = JSON.parse(e.target.result);
                    palettes = { ...palettes, ...importedPalettes };
                    currentPalette = Object.keys(palettes)[0] || '';
                    updatePaletteSelect();
                    renderTable();
                    displayNotification('Palettes imported successfully!');
                } catch (error) {
                    displayNotification('Error importing palettes. Please make sure the file is a valid JSON.');
                }
            };
            reader.readAsText(file);
        }
    });

    // Function to add a color to the current palette
    function addColor(hex) {
        palettes[currentPalette].push(hex);
        renderTable();
    }

    // Function to render the color table
    function renderTable() {
        const table = document.getElementById('userColorTable');
        table.innerHTML = ''; // Clear existing content

        if (currentPalette && palettes[currentPalette]) {
            // Add caption for accessibility
            const caption = document.createElement('caption');
            caption.textContent = currentPalette;
            caption.className = 'hidden';
            table.appendChild(caption);
			table.classList.add('userTable');

            // Create thead
            const thead = document.createElement('thead');
            thead.setAttribute('role', 'rowgroup');
            const headerRow = document.createElement('tr');
            headerRow.setAttribute('role', 'row');

            const headers = ['Colour', 'Trichromacy', 'Protanopia', 'Deuteranopia', 'Tritanopia', 'Delete'];
            headers.forEach(header => {
                const th = document.createElement('th');
                th.setAttribute('scope', 'col');
                th.setAttribute('role', 'columnheader');
                th.textContent = header;
				th.setAttribute("id", header);
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Create tbody
            const tbody = document.createElement('tbody');
            tbody.setAttribute('role', 'rowgroup');

            palettes[currentPalette].forEach((color, index) => {
                const row = document.createElement('tr');
                row.setAttribute('role', 'row');

                // Color header cell
                const colorHeader = document.createElement('th');
                colorHeader.setAttribute('scope', 'row');
                colorHeader.setAttribute('data-label', 'colour');
                colorHeader.setAttribute('role', 'rowheader');
                colorHeader.textContent = color;
                row.appendChild(colorHeader);

                // Color cells
                const cellTypes = ['trichromacy', 'protanopia', 'deuteranopia', 'tritanopia'];
                cellTypes.forEach(type => {
                    const td = document.createElement('td');
                    td.className = type;
                    td.setAttribute('data-label', type);
                    td.setAttribute('role', 'cell');
                    td.style.backgroundColor = color;
					td.style.color = color;
                    row.appendChild(td);
					td.textContent += 'Example';
					td.classList.add("paletteExampleCell");
                });

                // Actions cell
                const actionsCell = document.createElement('td');
                actionsCell.setAttribute('data-label', 'actions');
                actionsCell.setAttribute('role', 'cell');
                const removeButton = document.createElement('button');
                // removeButton.textContent = '\u232B';
				removeButton.innerHTML = `<span aria-hidden="true">\u232B</span>`;
                removeButton.setAttribute('aria-label', `Remove colour ${color}`);
                removeButton.onclick = () => removeColor(index);
                actionsCell.appendChild(removeButton);
				actionsCell.classList.add("actionClass")
                row.appendChild(actionsCell);

                tbody.appendChild(row);
            });

            table.appendChild(tbody);
        }
    }

    // Function to remove a color from the current palette
    function removeColor(index) {
        if (currentPalette && palettes[currentPalette]) {
            palettes[currentPalette].splice(index, 1);
            renderTable();
        }
    }

    // Function to update the palette select dropdown
    function updatePaletteSelect() {
        paletteSelect.innerHTML = '';
        Object.keys(palettes).forEach(name => {
            const option = document.createElement('option');
            option.value = name;
            option.textContent = name;
            paletteSelect.appendChild(option);
        });
        paletteSelect.value = currentPalette;
    }

    // Expose removeColor function globally
    window.removeColor = removeColor;

    // Load saved palettes on initial load
    const savedPalettes = localStorage.getItem('colorPalettes');
    if (savedPalettes) {
        palettes = JSON.parse(savedPalettes);
        currentPalette = Object.keys(palettes)[0] || '';
        updatePaletteSelect();
        renderTable();
    }
});

// Palette Editing ends

// Clear message function
function clearMessage() {
	document.getElementById('pageMessage').textContent = '';
	document.getElementById('myMessage').style.display = 'none';
}

/**
 * Displays a notification to the user.
 * @param {string} message - The message to display.
 * @param {string} type - The type of notification ('success' or 'error').
 */
function displayNotification(message, type) {
	document.getElementById('myMessage').style.display = 'block';
    const notification = document.getElementById('pageMessage');
    notification.textContent = message;

}
    </script>
      <script>
         function menuAction() {
             let menuSwitch = document.getElementById("myTopnav");
             if (menuSwitch.className === "topnav") {
                 menuSwitch.className += " responsive";
                 
             } else {
                 menuSwitch.className = "topnav";
             }
             let menuAriaAttrib = document.getElementById("menu").getAttribute("aria-expanded");
             if (menuAriaAttrib === "true") {
                 menuAriaAttrib = "false"
             } else {
                 menuAriaAttrib = "true"
             }
             document.getElementById("menu").setAttribute("aria-expanded", menuAriaAttrib);
         }

















      </script>
      <script>
         let mybutton = document.getElementById("myBtn");
         let mybutton2 = document.getElementById("myBtn2");
         
         
         window.onscroll = function() {
             scrollFunction()
         };
         
         function scrollFunction() {
             if (document.body.scrollTop > 660 || document.documentElement.scrollTop > 660) {
                 mybutton.style.display = "block";
         		mybutton2.style.display = "block";
             } else {
                 mybutton.style.display = "none";
         		mybutton2.style.display = "none";
             }
         }
         
         
         
         function topFunction() {
             document.body.scrollTop = 0;
             document.documentElement.scrollTop = 0; 
         document.getElementById('skipToContent').focus();
         }
         
         function bottomFunction() {
         window.scrollTo(0,document.body.scrollHeight);
         document.getElementById('rssA').focus();
         }
      </script>
      <script>
         let themePref = localStorage.getItem("theme");
         console.log("Has a theme preference been saved?", themePref);        
         
         
         function setLight() {
             let buttonStatus = document.getElementById("lightDark");
             let theButton = document.getElementById("modeToggle");
             const d = matchMedia('(prefers-color-scheme: dark)');
             let dt;
             if (d.matches) {
                 dt = 'dark';
                 console.log("Prefers dark theme in OS");
             } else {
                 dt = 'light'
                 console.log("Prefers light theme in OS");
             }
             if (dt == 'dark' && themePref == 'Dark') {
                 theButton.setAttribute("aria-pressed", "true");
             } else if (dt == 'light' && themePref == 'Dark') {
                 theButton.setAttribute("aria-pressed", "true");
             } else if (dt == 'dark' && !themePref) {
                 theButton.setAttribute("aria-pressed", "true");
             } else {
                 theButton.setAttribute("aria-pressed", "false");
             }
         }
         setLight();
         
         function toggle(btnID) {
             let buttonStatus = document.getElementById("lightDark");
             let theButton = document.getElementById(btnID);
             if (theButton.getAttribute("aria-pressed") == "true") {
                 theButton.setAttribute("aria-pressed", "false");
                 document.getElementById('lightCSS').href = 'light.css';
                 document.getElementById('darkCSS').href = 'light.css';
                 console.log("Turned on light mode");
                 localStorage.setItem("theme", "Light");
                 let themePref = localStorage.getItem("theme");
                 console.log("Site theme preference to ", themePref);
                 document.getElementById('lightDark').innerHTML = 'Light theme enabled, the button is now';
                 let toggleButton = document.getElementById('modeToggle');
                 toggleButton.removeAttribute("aria-pressed");
                 toggleButton.setAttribute("aria-pressed", "false");
             } else {
                 theButton.setAttribute("aria-pressed", "true");
                 document.getElementById('lightCSS').href = 'dark.css';
                 document.getElementById('darkCSS').href = 'dark.css';
                 console.log("Turned on dark mode");
                 localStorage.setItem("theme", "Dark");
                 let themePref = localStorage.getItem("theme");
                 console.log("Site theme preference set to ", themePref);
                 document.getElementById('lightDark').innerHTML = 'Dark theme enabled, the button is now';
                 let toggleButton = document.getElementById('modeToggle');
                 toggleButton.removeAttribute("aria-pressed");
                 toggleButton.setAttribute("aria-pressed", "true");
             }
         }
         
         function applyThemePreference() {
             if (themePref == 'Dark') {
                 let theButton = document.getElementById('modeToggle');
                 document.getElementById('lightCSS').href = 'dark.css';
                 document.getElementById('darkCSS').href = 'dark.css';
                 theButton.setAttribute("aria-pressed", "true");
                 console.log("Applied", themePref, "theme because site theme preference is set to", themePref);
             } else if (themePref == 'Light') {
                 let theButton = document.getElementById('modeToggle');
                 document.getElementById('lightCSS').href = 'light.css';
                 document.getElementById('darkCSS').href = 'light.css';
                 theButton.setAttribute("aria-pressed", "false");
                 console.log("Applied", themePref, "theme because site theme preference is set to", themePref);
             }
         }
         applyThemePreference();                
      </script>
	  <script src="scripts/jquery-3.7.1.min.js"></script>
    <script src="scripts/details.js"></script>
    <script>
      window.console || (window.console = {
        'log': alert
      });
      $(function() {
        $('html').addClass($.fn.details.support ? 'details' : 'no-details');
        $('details').details();
        $('details').on({
          'open.details': function() {
            console.log('opened')
          },
          'close.details': function() {
            console.log('closed')
          }
        })
      });
    </script>
	    <script>
      // Expand details / summary when printing
      // From https://stackoverflow.com/questions/19646684/force-open-the-details-summary-tag-for-print-in-chrome
      window.matchMedia("print").addEventListener("change", evt => {
        if (evt.matches) {
          elms = document.body.querySelectorAll("details:not([open])");
          for (e of elms) {
            e.setAttribute("open", "");
            e.dataset.wasclosed = "";
          }
        } else {
          elms = document.body.querySelectorAll("details[data-wasclosed]");
          for (e of elms) {
            e.removeAttribute("open");
            delete e.dataset.wasclosed;
          }
        }
      })
    </script>
<script>
//
// Explanation
//
// The code uses async/await for handling asynchronous operations, which makes the code easier to read and maintain compared to using callbacks or promises directly.
//
// The createTables function is the core of this script. It fetches JSON data containing color palettes and dynamically creates HTML tables to display these palettes. This approach allows for easy updates to the palettes without changing the HTML structure.
//
//
// The appendTestToCells function demonstrates how to select specific elements using CSS selectors and modify their content. This is useful for adding or changing content after the initial page load.
//
// The indexCreate function shows how to create a table of contents dynamically. This is helpful for improving navigation on long pages.
//
// Throughout the code, there's a focus on accessibility. This includes:
// 
// Using semantic HTML elements (like <caption>, <th>, etc.)
// Creating an index for easier navigation
// 
// 
// The code uses try-catch blocks for error handling.


// Wait for the DOM to be fully loaded before executing the main function
document.addEventListener('DOMContentLoaded', async function() {    
    // Create tables based on color palette data
    await createTables();
    // Add example text to table cells
    appendTestToCells();
    // Create an index of h2 elements
    indexCreate();
});

/**
 * Fetches color palette data and creates tables for each palette
 */
async function createTables() {
    try {
        // Fetch the JSON data containing color palettes
        const response = await fetch('https://matthewdeeprose.github.io/cvdp.json');
        const data = await response.json();
        const palettes = data.palettes;
        const container = document.getElementById('insertHere');

        // Iterate through each palette in the data
        for (const paletteName in palettes) {
            if (palettes.hasOwnProperty(paletteName)) {
                const colors = palettes[paletteName];

                // Create a section for each palette
                const section = document.createElement('section');
                section.id = paletteName.replace(/\s+/g, '') + 'Section';

                // Add a heading for the palette
                const h2 = document.createElement('h2');
                h2.textContent = paletteName;
                section.appendChild(h2);

                // Create a table for the palette
                const table = document.createElement('table');
                table.id = paletteName.replace(/\s+/g, '') + 'Table';
                table.classList.add("paletteTable");

                // Add a caption to the table (hidden for visual users, useful for screen readers)
                const caption = document.createElement('caption');
                caption.className = 'hidden';
                caption.textContent = paletteName;
                table.appendChild(caption);

                // Create the table header
                const thead = document.createElement('thead');
                thead.setAttribute('role', 'rowgroup');
                const headerRow = document.createElement('tr');
                headerRow.setAttribute('role', 'row');

                const headers = ['Colour', 'Trichromacy', 'Protanopia', 'Deuteranopia', 'Tritanopia'];
                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.setAttribute('scope', 'col');
                    th.setAttribute('role', 'columnheader');
                    th.textContent = headerText;
                    th.classList.add("paletteColumnHeader");
                    headerRow.appendChild(th);
                });

                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Create the table body
                const tbody = document.createElement('tbody');
                tbody.setAttribute('role', 'rowgroup');

                // Create a row for each color in the palette
                colors.forEach(color => {
                    const row = document.createElement('tr');
                    row.setAttribute('role', 'row');

                    // Add the color name as a row header
                    const rowHeader = document.createElement('th');
                    rowHeader.setAttribute('scope', 'row');
                    rowHeader.setAttribute('data-label', 'colour');
                    rowHeader.setAttribute('role', 'rowheader');
                    rowHeader.textContent = color;
                    row.appendChild(rowHeader);

                    // Create cells for each color vision type
                    ['Trichromacy', 'protanopia', 'deuteranopia', 'tritanopia'].forEach(label => {
                        const cell = document.createElement('td');
                        cell.className = label;
                        cell.setAttribute('data-label', label);
                        cell.setAttribute('role', 'cell');
                        cell.style.backgroundColor = color;
                        cell.style.color = color;
                        cell.classList.add("paletteExampleCell");
                        row.appendChild(cell);
                    });

                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                section.appendChild(table);
                container.appendChild(section);
            }
        }
        console.log('Tables created');
    } catch (error) {
        console.error('Error fetching the JSON data:', error);
    }
}

/**
 * Adds the word "Example" to each cell in tables that are not of class 'userTable'
 */
function appendTestToCells() {
    // Select all table cells except those in tables with class 'userTable'
    const cells = document.querySelectorAll('table:not(.userTable) td');
    
    // Add the word "Example" to each cell
    cells.forEach(cell => {
        cell.textContent += 'Example';
    });
    
    console.log('Text appended to cells (excluding userTable)');
}

/**
 * Creates an index of h2 elements and adds them to a list with ID 'index'
 */
function indexCreate() {
    // Add IDs to all heading elements that don't have one
    const headings = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
    headings.forEach(heading => {
        if (!heading.id) {
            heading.id = heading.textContent.replace(/\s+/g, '');
        }
    });

    // Create list items for each H2 and add them to the index
    const contentsList = document.getElementById("index");
    if (contentsList) {
        const h2Elements = document.querySelectorAll("h2");
        h2Elements.forEach(h2 => {
            if (h2.textContent !== "Contents") {
                const listItem = document.createElement("li");
                const link = document.createElement("a");
                link.href = `#${h2.id}`;
                link.textContent = h2.textContent;
                listItem.appendChild(link);
                contentsList.appendChild(listItem);
            }
        });
        console.log('Index created');
    }
}
</script>

   </body>
</html>
