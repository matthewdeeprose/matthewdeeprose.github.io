<!DOCTYPE html>
<html lang="en-GB">
   <head>
      <meta charset="utf-8" />
      <meta name="description" content="Colour Vision Deficiency Image Tester">
      <meta name="keywords" content="accessibility, presentation, blog">
      <meta name="author" content="Matthew Deeprose">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Colour Vision Deficiency Image Tester</title>
      <link rel="stylesheet" id="lightCSS" href="light.css" media="(prefers-color-scheme: light)">
      <link rel="stylesheet" id="mainCSS" href="main.css" media="all">
      <link rel="stylesheet" id="darkCSS" href="dark.css" media="(prefers-color-scheme: dark)">
      <link rel="stylesheet" id="printCSS" href="print.css" media="print">
      <meta property="og:title" content="Colour Vision Deficiency Image Tester - Matthew Deeprose">
      <meta property="og:description" content="With this tool you can upload an image and view how it appears under a simulation of different types of colour vision deficiency, or colour blindness.">
      <meta property="og:image" content="https://matthewdeeprose.github.io/cvdImage43.png">
	  <meta property="og:image:width" content="2500" />
	  <meta property="og:image:height" content="1306" />
      <meta property="og:image:alt" content="">
      <meta property="og:locale" content="en_GB">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://matthewdeeprose.github.io/imageCVD.html">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="theme-color" content="#231F20" media="(prefers-color-scheme: dark)">
      <meta name="theme-color" content="#FFFFF4" media="(prefers-color-scheme: light)">
      <link rel="icon" href="favicon.ico">
      <link rel="alternate" type="application/rss+xml" title="RSS Feed for matthewdeeprose.github.io" href="https://matthewdeeprose.github.io/feed.rss">
      <link rel="icon" href="favicon.svg" type="image/svg+xml">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="Colour Vision Deficiency Image Tester - Matthew Deeprose" />
      <meta name="twitter:description" content="With this tool you can upload an image and view how it appears under a simulation of different types of colour vision deficiency, or colour blindness."/>
      <meta name="twitter:creator" content="@VLEguru"/>
      <meta name="twitter:site" content="@VLEguru"/>
      <meta name="twitter:image" content="https://matthewdeeprose.github.io/cvdImage43.png"/>
      <meta name="twitter:image:alt" content=""/>
      <meta name="twitter:card" content="summary_large_image"/>
	      <style>
 .page-wrap > * {
  grid-column: 1/-1 !important;
  grid-row: auto !important;
}

.size-control {
  margin: 20px 0;
  display: none;
}

.size-control input[type="range"] {
  width: 100%;
  margin: 10px 0;
}

.size-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.875rem;
}

.image-grid {
  display: grid;
  grid-template-columns: repeat(
    auto-fit,
    minmax(min(100%, var(--container-width, 400px)), 1fr)
  );
  gap: 2rem;
  margin-top: 20px;
  max-width: 100%;
  padding: 0 1rem;
}

.image-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.image-container h2 {
  margin-bottom: 10px;
  font-size: 1.2rem;
}

.image-wrapper {
  position: relative;
  width: 250px; /* Initial width */
  margin: 0 auto;
  max-width: calc(
    100% - 2rem
  ); /* Ensure container doesn't overflow its grid cell */
}

.image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

@media (max-width: 1200px) {
  .image-grid {
    grid-template-columns: 1fr;
  }

  .image-wrapper {
    width: min(100%, 800px) !important;
  }
}

.upload-container {
  border: 2px dashed currentcolor;
  padding: 20px;
  text-align: center;
  margin-bottom: 20px;
  border-radius: 4px;
}
.size-value {
  text-align: center;
  margin: 0.5rem 0;
  font-weight: 600;
}
/* wider border just for this page */
@media (min-width: 60rem) {
  .page-wrap {
    margin: 0 5% 0 5%;
  }
}

/* Hide file input visually while keeping it accessible */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  border: 0;
}

.error-message {
  color: #d32f2f;
  background-color: #ffebee;
  padding: 10px;
  border-radius: 4px;
  margin: 10px 0;
  display: none;
}

	  
	  /* Filters */

.protanopia {
	-webkit-filter: url(#protanopia);
	-moz-filter: url(#protanopia);
	-ms-filter: url(#protanopia);
	-o-filter: url(#protanopia);
	filter: url(#protanopia);
}

.deuteranopia {
	-webkit-filter: url(#deuteranopia);
	-moz-filter: url(#deuteranopia);
	-ms-filter: url(#deuteranopia);
	-o-filter: url(#deuteranopia);
	filter: url(#deuteranopia);
}

.tritanopia {
	-webkit-filter: url(#tritanopia);
	-moz-filter: url(#tritanopia);
	-ms-filter: url(#tritanopia);
	-o-filter: url(#tritanopia);
	filter: url(#tritanopia);
}
    </style>
   </head>
   <body>
      <div class="page-wrap" id="start">
         <a class="skip-link" id="skipToContent" href='#main'>Skip to content</a>
         <header class="page-header">
            <div id="banner">
               <div id="logo">
                  <button id="modeToggle" aria-label="Change between light and dark theme" aria-pressed="false" onclick="toggle(this.id);">
                     <svg id="logoSVG" height="45" viewBox="0 0 21 21" width="45" xmlns="http://www.w3.org/2000/svg" aria-labelledby="svgTitle svgDesc" role="img">
                        <title id="svgTitle">Change theme</title>
                        <desc id="svgDesc">Select to switch to light theme</desc>
                        <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 1)">
                           <path d="m6.5 17.5h4"/>
                           <path d="m8.5 4c2.4852814 0 4.5 2.01471863 4.5 4.5 0 1.7663751-1.017722 3.2950485-2.4987786 4.031633l-.0012214.968367c0 1.1045695-.8954305 2-2 2s-2-.8954305-2-2l-.00021218-.9678653c-1.48160351-.7363918-2.49978782-2.2653584-2.49978782-4.0321347 0-2.48528137 2.01471863-4.5 4.5-4.5z"/>
                           <path d="m8.5 1.5v-1"/>
                           <path d="m13.5 3.5 1-1"/>
                           <path d="m2.5 3.5 1-1" transform="matrix(-1 0 0 1 6 0)"/>
                           <path d="m13.5 13.5 1-1" transform="matrix(1 0 0 -1 0 26)"/>
                           <path d="m2.5 13.5 1-1" transform="matrix(-1 0 0 -1 6 26)"/>
                           <path d="m1.5 7.5h-1"/>
                           <path d="m16.5 7.5h-1"/>
                        </g>
                     </svg>
                     <svg id="logoSVG-Off" height="45" viewBox="0 0 21 21" width="45" xmlns="http://www.w3.org/2000/svg" aria-labelledby="svgTitleX svgDescX">
                        <title id="svgTitleX">Change theme</title>
                        <desc id="svgDescX">Select to switch to dark theme</desc>
                        <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(6 5)">
                           <path d="m2.5 13.5h4"/>
                           <path d="m4.5 0c2.48528137 0 4.5 2.01471863 4.5 4.5 0 1.76637512-1.01772197 3.29504854-2.49877863 4.03163297l-.00122137.96836703c0 1.1045695-.8954305 2-2 2s-2-.8954305-2-2l-.00021218-.96786527c-1.48160351-.73639182-2.49978782-2.26535843-2.49978782-4.03213473 0-2.48528137 2.01471863-4.5 4.5-4.5z"/>
                        </g>
                     </svg>
                  </button>
               </div>
               <span role="alert" class="hidden" aria-live="polite" id="lightDark"></span>
               <div id="titleLink">Matthew Deeprose</div>
            </div>
         </header>
         <div id="main-navigation" class="page-nav">
            <nav aria-label="Main menu" class="topnav" id="myTopnav">
               <button id="menu" aria-controls="myTopnav" aria-labelledby="myTopnav" aria-expanded="false" class="icon"  aria-haspopup="menu" onclick="menuAction()">
                  <span id="hamburger">
                     <svg id="hamSVG" viewBox="0 0 100 80" width="20" height="20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="img">
                        <title id="hamSVGTitle">Menu</title>
                        <desc id="hamSVGDesc">Select to expand or collapse the menu</desc>
                        <rect width="100" height="20"></rect>
                        <rect y="30" width="100" height="20"></rect>
                        <rect y="60" width="100" height="20"></rect>
                     </svg>
                  </span>
                  <span id="arrow">
                     <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" focusable="false">
                        <title id="arrowSVGTitle">Menu</title>
                        <desc id="arrowSVGDesc">Select to expand or collapse the menu</desc>
                        <g stroke-width="4"  stroke-linejoin="round" stroke-linecap="round" stroke="currentColor" fill-rule="evenodd" fill="none">
                           <path  d="m7.499,6.497l-3.999,4.002l4,4.001"/>
                           <path  d="m16.5,10.5l-13,0"/>
                        </g>
                     </svg>
                  </span>
               </button>
               <a id="homeMenu" href="index.html">Home</a>
               <a href="presentations.html" aria-current="page" class="active">Presentations</a>
               <a href="posts.html">Blog Posts</a>
               <a href="projects.html">Projects</a>
               <a href="about.html">About</a>
            </nav>
         </div>
         <main class="page-main" id="main">
            <article class="standard">
               <h1 id="top">Colour Vision Deficiency Image Tester</h1>
			   <details>
			<summary class="Instructions">
              <h2 id="Contents">Information and Instructions</h2>
            </summary>
			<h3>About this tool</h3>
			<p>With this tool you can upload an image and view how it appears under a simulation of different types of colour vision deficiency, or colour blindness.</p>
			<p><a href="https://en.wikipedia.org/wiki/Color_blindness">Learn more about colour vision deficiency</a>.</p>
			<h3>How to use this tool</h3>
			<ol>
			<li>Upload you image.</li>
			<li>Review your image under different colour vision deficiency simulations.</li>
			<li>Use the slider control to change the size of your image.</a>.</li>
			</ol>
			<h3>Data and privacy</h3>
			<p>All interactions with this tool take place only on your computer. No data is shared externally.</p>
			
			<h3>Credits</h3>
			<p>This tool uses the following:
			<ul>
			<li><a href="https://daltonlens.org/cvd-simulation-svg-filters/">Accurate SVG filters for color blindness simulation</a> by Nicolas Burrus.</li>
			</ul>
			
			
			</p>
			</details>
    <div class="upload-container" id="uploadContainer">
        <input 
            type="file" 
            id="fileInput" 
            class="sr-only"
            accept=".png,.jpg,.jpeg,.webp"
            aria-label="Upload image"
        >
        <button class="upload-button" onclick="document.getElementById('fileInput').click()">
            Choose image
        </button>
        <p class="upload-text">or drag and drop here</p>
        <p class="upload-text">Supported formats: PNG, JPEG, WebP</p>
    </div>

    <div class="error-message" role="alert" id="errorMessage"></div>

    <div class="size-control" id="sizeControl">
        <label for="sizeSlider">Adjust image size</label>
		        <div class="size-value" id="sizeValue" role="status" aria-live="polite">
            Current width: 250 pixels
        </div>
        <input 
            type="range" 
            id="sizeSlider" 
            min="200" 
            max="800" 
            value="250"
            step="50"
        >
        <div class="size-labels">
            <span>200px</span>
            <span>800px</span>
        </div>
    </div>

    <div class="image-grid" id="imageGrid">
        <div class="image-container">
            <h2>Original (Trichromacy)</h2>
            <div class="image-wrapper trichromacy"></div>
        </div>
        <div class="image-container">
            <h2>Protanopia</h2>
            <div class="image-wrapper protanopia"></div>
        </div>
        <div class="image-container">
            <h2>Deuteranopia</h2>
            <div class="image-wrapper deuteranopia"></div>
        </div>
        <div class="image-container">
            <h2>Tritanopia</h2>
            <div class="image-wrapper tritanopia"></div>
        </div>
    </div>

            </article>
			      <div id="panel">
         <button class="panelButton" onclick="topFunction()" id="myBtn">
            <svg id="svgUP" height="50" viewBox="0 0 21 21" width="50" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle2 svgDesc2">
               <title id="svgTitle2">Top.</title>
               <desc id="svgDesc2">Move to the top of the page.</desc>
               <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 2)">
                  <circle cx="8.5" cy="8.5" r="8"/>
                  <path d="m11.5 7.5-3-3-3 3"/>
                  <path d="m8.5 4.5v8"/>
               </g>
            </svg>
            <br />
            <span id="myBtnTop" class="panelLabel">Top</span>
         </button>
         <button class="panelButton" onclick="bottomFunction()" id="myBtn2">
            <svg id="svgDOWN" height="50" viewBox="0 0 21 21" width="50" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle3 svgDesc3">
               <title id="svgTitle3">Bottom.</title>
               <desc id="svgDesc3">Move to the bottom of the page.</desc>
               <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(3 2)">
                  <circle cx="8.5" cy="8.5" r="8"/>
                  <path d="m5.5 9.5 3 3 3-3"/>
                  <path d="m8.5 12.5v-8"/>
               </g>
            </svg>
            <br />
            <span id="myBtnBottom" class="panelLabel">Bottom</span>
         </button>
      </div>
         </main>
         <aside class="page-sidebar related">
            <section class="related">
			<h2>Related content</h2>
			</section>
            <section class="related">
               <ul class="relUL">
                  <li><a href="svgCVD">SVG Palette Adjuster for Colour Vision Deficiency</a></li>
                  <li><a href="CVDP">Colour vision deficiency friendly palettes</a></li>
                  <li><a href="a11y-brand-colour-contrast-suggest">Brand Accessible Colour Contrast Suggester</a></li>
               </ul>
            </section>
         </aside>
         <footer class="page-footer">
            <div id="RSS"><a id="rssA" href="feed.rss">RSS</a></div>
            <div id="SiteMap"><a href="siteMap.html">Site Map</a></div>
            <div id="AccessibilityFoot">
               <a href="Accessibility_Statement.html">Accessibility Statement</a>
            </div>
            <div id="twitterFoot">
               <a href="https://twitter.com/vleguru?ref_src=twsrc%5Etfw">Follow on Twitter</a>
            </div>
            <div id="YouTubeChannelFoot">
               <a href="https://www.youtube.com/channel/UCKypjo59GE79UEjoLtzKEtQ">YouTube Channel</a>
            </div>
            <div id="aboutCodePen"><a href="https://codepen.io/matthewdeeprose/">CodePen</a></div><p><div id="aboutFoot">
               <div id="CC">
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC-BY-SA</a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/InteractiveResource" property="dct:title" rel="dct:type">svgCVD</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"><a href="https://www.linkedin.com/in/mattdeeprose/">Matthew Deeprose</a></span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
<p>To simulate CVD it uses <a href="https://daltonlens.org/cvd-simulation-svg-filters/">Accurate SVG filters for color blindness simulation</a> by Nicolas Burrus, released as "free and unencumbered software released into the public domain".</p></div>
            </div>
         </p></footer>
      </div>
	  	     <!-------------------------------------------------------------------
    DaltonLens SVG filters to simulate color vision deficiencies 
    
    https://daltonlens.org/opensource-cvd-simulation/ for a
    discussion of the various methods.     

    The various matrices were generated from DaltonLens-Python.

    It is very important for these filters to get applied in     
    linearRGB, which is supposed to be the default, but never
    hurts to specify it explicitly.
-------------------------------------------------------------------->
<svg style='height: 0; width: 0; padding: 0; margin: 0; line-height: 0;'>
    <!-- Single matrix approximation of Viénot, Brettel & Mollon 1999 -->
    <filter id="protanopia" color-interpolation-filters="linearRGB">
        <feColorMatrix type="matrix" in="SourceGraphic" values="
            0.10889,0.89111,-0.00000,0,0
            0.10889,0.89111,0.00000,0,0
            0.00447,-0.00447,1.00000,0,0
            0,0,0,1,0"
        />
    </filter>

    <!-- Single matrix approximation of Viénot, Brettel & Mollon 1999 -->
    <filter id="deuteranopia" color-interpolation-filters="linearRGB">
        <feColorMatrix type="matrix" in="SourceGraphic" values="
            0.29031,0.70969,-0.00000,0,0
            0.29031,0.70969,-0.00000,0,0
            -0.02197,0.02197,1.00000,0,0
            0,0,0,1,0"
        />
    </filter>

    <!-- 
        Brettel, Viénot & Mollon 1997 algorithms with two projection planes.

        This is the only approach I know that is supposed to be reasonably
        accurate for tritanopia, the single matrix approaches are NOT accurate.
    -->
    <filter id="tritanopia" color-interpolation-filters="linearRGB">
        <!-- 
            Projection 1, with a special alpha that encodes the separation plane.
            If dot(rgb, n) > 0, then use projection 1, otherwise use projection 2.
            This is encoded in alpha by:
                - Applying a 1.0 factor on the source alpha so that 0 input alpha remains 0
                - Subtracting 0.2 so that negative values become < 0.8 and position values >= 0.8
                - It is important to normalize the factors to keep a good numerical accuracy
                  and to keep a large alpha threshold since the RGB values are then stored
                  premultiplied by alpha.
                - This assumes that negative values get clipped to 0, and positive
                  values clipped to 1, without overflowing, etc. Which seems to be the case
                  on all browsers.
          -->
        <feColorMatrix type="matrix" in="SourceGraphic" result="ProjectionOnPlane1" values="
            1.01354, 0.14268, -0.15622, 0, 0
            -0.01181, 0.87561, 0.13619, 0, 0
            0.07707, 0.81208, 0.11085, 0, 0
            7.92482, -5.66475, -2.26007, 1, -0.2"
        />
        <!-- 
            Binarize alpha. 5 values means the last chunk will start at 0.8.
            All the values below 0.8 will become 0 (correspond to the dot
            product with the separation plane being negative) and above will become 1
        -->        
        <feComponentTransfer in="ProjectionOnPlane1" result="ProjectionOnPlane1">
            <feFuncA type="discrete" tableValues="0 0 0 0 1"/>
        </feComponentTransfer>

        <feColorMatrix type="matrix" in="SourceGraphic" result="ProjectionOnPlane2" values="
            0.93337, 0.19999, -0.13336, 0, 0
            0.05809, 0.82565, 0.11626, 0, 0
            -0.37923, 1.13825, 0.24098, 0, 0
            0,0,0,1,0"
        />

        <!-- Uncomment the debug black matrix to see which pixels go to which plane -->
        <!-- <feColorMatrix type="matrix" in="SourceGraphic" result="ProjectionOnPlane2" values="0,0,0,0,0 0,0,0,0,0 0,0,0,0,0 0,0,0,1,0"/> -->

        <!-- Blend the two projections, picking one or the other depending on alpha. -->
        <feBlend in="ProjectionOnPlane1" in2="ProjectionOnPlane2" mode="normal"/>
    </filter>
</svg>
<!------------------------------------------------------------------>
<script>
// This will run when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    const imageGrid = document.getElementById('imageGrid');
    if (imageGrid) {
        imageGrid.style.display = 'none';
    }
});
</script>
<script>
/**
 * @fileoverview This script handles image upload functionality with drag-and-drop support
 * and displays the uploaded image with different simulations. It includes features for
 * resizing the displayed images and handling various error states.
 * 
 * @requires DOM The script requires a fully loaded DOM with specific elements:
 * - fileInput: Input element for file selection
 * - uploadContainer: Container for drag and drop functionality
 * - errorMessage: Element to display error messages
 * - sizeControl: Container for size adjustment controls
 * - sizeSlider: Range input for adjusting image size
 * - imageWrappers: Collection of elements that will contain the images
 */

document.addEventListener('DOMContentLoaded', function() {
    /**
     * @description Initialize all required DOM elements
     * @type {HTMLElement} fileInput - File input element for image upload
     * @type {HTMLElement} uploadContainer - Container element for drag and drop
     * @type {HTMLElement} errorMessage - Element to display error messages
     * @type {HTMLElement} sizeControl - Container for size adjustment controls
     * @type {HTMLElement} sizeSlider - Range input for size adjustment
     * @type {NodeList} imageWrappers - Collection of image container elements
     */
    const fileInput = document.getElementById('fileInput');
    const uploadContainer = document.getElementById('uploadContainer');
    const errorMessage = document.getElementById('errorMessage');
    const sizeControl = document.getElementById('sizeControl');
    const sizeSlider = document.getElementById('sizeSlider');
    const imageWrappers = document.querySelectorAll('.image-wrapper');

    /**
     * @type {string|null} currentImage - Stores the current image data URL
     * @type {number} aspectRatio - Stores the aspect ratio of the uploaded image
     */
    let currentImage = null;
    let aspectRatio = 1;

    // Event Listeners Setup
    fileInput.addEventListener('change', handleFileSelect);

    /**
     * @description Handles dragover event by preventing default behavior and adding visual feedback
     * @param {DragEvent} e - The dragover event object
     */
    uploadContainer.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadContainer.classList.add('drag-over');
    });

    /**
     * @description Removes visual feedback when drag leaves the upload area
     */
    uploadContainer.addEventListener('dragleave', function() {
        uploadContainer.classList.remove('drag-over');
    });

    /**
     * @description Handles file drop events by processing the dropped files
     * @param {DragEvent} e - The drop event object
     */
    uploadContainer.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadContainer.classList.remove('drag-over');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFileSelect({
                target: fileInput
            });
        }
    });

    /**
     * @description Handles size slider changes and updates the display
     * @param {Event} e - The input event from the slider
     */
    sizeSlider.addEventListener('input', function(e) {
        const newSize = e.target.value;
        const sizeText = `${newSize} pixels`;

        document.getElementById('sizeValue').textContent = `Current width: ${sizeText}`;

        // Update accessibility attributes
        this.setAttribute('aria-valuenow', newSize);
        this.setAttribute('aria-valuetext', sizeText);

        updateImageSize(newSize);
    });

    /**
     * @description Processes the selected file and displays it if valid
     * @param {Event} e - The file selection event
     */
    function handleFileSelect(e) {
        const file = e.target.files[0];
        const imageGrid = document.getElementById('imageGrid');
        imageGrid.style.display = 'none';

        if (!file) return;

        /**
         * @type {Array<string>} validTypes - List of accepted image file types
         */
        const validTypes = ['image/png', 'image/jpeg', 'image/webp'];
        if (!validTypes.includes(file.type)) {
            showError('Please upload a PNG, JPEG, or WebP image.');
            return;
        }

        const reader = new FileReader();

        /**
         * @description Handles successful file read and image loading
         * @param {ProgressEvent} e - The file reader load event
         */
        reader.onload = function(e) {
            const img = new Image();

            /**
             * @description Sets up the image display once the image is loaded
             */
            img.onload = function() {
                aspectRatio = img.width / img.height;
                currentImage = e.target.result;

                // Update all image containers with the new image
                imageWrappers.forEach(wrapper => {
                    const imgElement = document.createElement('img');
                    imgElement.src = currentImage;
                    imgElement.alt = `${wrapper.className.split(' ')[1]} color vision simulation`;

                    wrapper.innerHTML = '';
                    wrapper.appendChild(imgElement);
                });

                sizeControl.style.display = 'block';
                updateImageSize(sizeSlider.value);
                hideError();
                imageGrid.style.display = 'grid';
            };

            /**
             * @description Handles image loading errors
             */
            img.onerror = function() {
                showError('Failed to load image. Please try another file.');
            };

            img.src = e.target.result;
        };

        /**
         * @description Handles file reading errors
         */
        reader.onerror = function() {
            showError('Failed to read file. Please try again.');
        };

        reader.readAsDataURL(file);
    }

    /**
     * @description Updates the size of all displayed images
     * @param {number} size - The new width in pixels
     */
    function updateImageSize(size) {
        const height = size / aspectRatio;

        document.documentElement.style.setProperty('--container-width', size + 'px');

        imageWrappers.forEach(wrapper => {
            wrapper.style.width = `${size}px`;
            wrapper.style.height = `${height}px`;
        });
    }

    /**
     * @description Displays an error message to the user
     * @param {string} message - The error message to display
     */
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
    }

    /**
     * @description Hides the error message display
     */
    function hideError() {
        errorMessage.style.display = 'none';
    }

    /**
     * @description Enables keyboard accessibility for the upload container
     * @param {KeyboardEvent} e - The keyboard event
     */
    uploadContainer.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            fileInput.click();
        }
    });
});
    </script>
      <script>
         function menuAction() {
             let menuSwitch = document.getElementById("myTopnav");
             if (menuSwitch.className === "topnav") {
                 menuSwitch.className += " responsive";
                 
             } else {
                 menuSwitch.className = "topnav";
             }
             let menuAriaAttrib = document.getElementById("menu").getAttribute("aria-expanded");
             if (menuAriaAttrib === "true") {
                 menuAriaAttrib = "false"
             } else {
                 menuAriaAttrib = "true"
             }
             document.getElementById("menu").setAttribute("aria-expanded", menuAriaAttrib);
         }

















      </script>
      <script>
         let mybutton = document.getElementById("myBtn");
         let mybutton2 = document.getElementById("myBtn2");
         
         
         window.onscroll = function() {
             scrollFunction()
         };
         
         function scrollFunction() {
             if (document.body.scrollTop > 660 || document.documentElement.scrollTop > 660) {
                 mybutton.style.display = "block";
         		mybutton2.style.display = "block";
             } else {
                 mybutton.style.display = "none";
         		mybutton2.style.display = "none";
             }
         }
         
         
         
         function topFunction() {
             document.body.scrollTop = 0;
             document.documentElement.scrollTop = 0; 
         document.getElementById('skipToContent').focus();
         }
         
         function bottomFunction() {
         window.scrollTo(0,document.body.scrollHeight);
         document.getElementById('rssA').focus();
         }
      </script>
      <script>
         let themePref = localStorage.getItem("theme");
         console.log("Has a theme preference been saved?", themePref);        
         
         
         function setLight() {
             let buttonStatus = document.getElementById("lightDark");
             let theButton = document.getElementById("modeToggle");
             const d = matchMedia('(prefers-color-scheme: dark)');
             let dt;
             if (d.matches) {
                 dt = 'dark';
                 console.log("Prefers dark theme in OS");
             } else {
                 dt = 'light'
                 console.log("Prefers light theme in OS");
             }
             if (dt == 'dark' && themePref == 'Dark') {
                 theButton.setAttribute("aria-pressed", "true");
             } else if (dt == 'light' && themePref == 'Dark') {
                 theButton.setAttribute("aria-pressed", "true");
             } else if (dt == 'dark' && !themePref) {
                 theButton.setAttribute("aria-pressed", "true");
             } else {
                 theButton.setAttribute("aria-pressed", "false");
             }
         }
         setLight();
         
         function toggle(btnID) {
             let buttonStatus = document.getElementById("lightDark");
             let theButton = document.getElementById(btnID);
             if (theButton.getAttribute("aria-pressed") == "true") {
                 theButton.setAttribute("aria-pressed", "false");
                 document.getElementById('lightCSS').href = 'light.css';
                 document.getElementById('darkCSS').href = 'light.css';
                 console.log("Turned on light mode");
                 localStorage.setItem("theme", "Light");
                 let themePref = localStorage.getItem("theme");
                 console.log("Site theme preference to ", themePref);
                 document.getElementById('lightDark').innerHTML = 'Light theme enabled, the button is now';
                 let toggleButton = document.getElementById('modeToggle');
                 toggleButton.removeAttribute("aria-pressed");
                 toggleButton.setAttribute("aria-pressed", "false");
             } else {
                 theButton.setAttribute("aria-pressed", "true");
                 document.getElementById('lightCSS').href = 'dark.css';
                 document.getElementById('darkCSS').href = 'dark.css';
                 console.log("Turned on dark mode");
                 localStorage.setItem("theme", "Dark");
                 let themePref = localStorage.getItem("theme");
                 console.log("Site theme preference set to ", themePref);
                 document.getElementById('lightDark').innerHTML = 'Dark theme enabled, the button is now';
                 let toggleButton = document.getElementById('modeToggle');
                 toggleButton.removeAttribute("aria-pressed");
                 toggleButton.setAttribute("aria-pressed", "true");
             }
         }
         
         function applyThemePreference() {
             if (themePref == 'Dark') {
                 let theButton = document.getElementById('modeToggle');
                 document.getElementById('lightCSS').href = 'dark.css';
                 document.getElementById('darkCSS').href = 'dark.css';
                 theButton.setAttribute("aria-pressed", "true");
                 console.log("Applied", themePref, "theme because site theme preference is set to", themePref);
             } else if (themePref == 'Light') {
                 let theButton = document.getElementById('modeToggle');
                 document.getElementById('lightCSS').href = 'light.css';
                 document.getElementById('darkCSS').href = 'light.css';
                 theButton.setAttribute("aria-pressed", "false");
                 console.log("Applied", themePref, "theme because site theme preference is set to", themePref);
             }
         }
         applyThemePreference();                
      </script>
	  <script src="scripts/lite-yt-embed.js"></script>
	  <link rel="stylesheet" href="scripts/lite-yt-embed.css"/>
	  	    <script src="scripts/jquery-3.7.1.min.js"></script>
    <script src="scripts/details.js"></script>
    <script>
      window.console || (window.console = {
        'log': alert
      });
      $(function() {
        $('html').addClass($.fn.details.support ? 'details' : 'no-details');
        $('details').details();
        $('details').on({
          'open.details': function() {
            console.log('opened')
          },
          'close.details': function() {
            console.log('closed')
          }
        })
      });
    </script>
	    <script>
      // Expand details / summary when printing
      // From https://stackoverflow.com/questions/19646684/force-open-the-details-summary-tag-for-print-in-chrome
      window.matchMedia("print").addEventListener("change", evt => {
        if (evt.matches) {
          elms = document.body.querySelectorAll("details:not([open])");
          for (e of elms) {
            e.setAttribute("open", "");
            e.dataset.wasclosed = "";
          }
        } else {
          elms = document.body.querySelectorAll("details[data-wasclosed]");
          for (e of elms) {
            e.removeAttribute("open");
            delete e.dataset.wasclosed;
          }
        }
      })
    </script>
   </body>
</html>
