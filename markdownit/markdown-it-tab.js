import{escapeHtml as M}from"@mdit/helper";const x="@tab",y=(t,e)=>(r,a,n,i)=>{if(e.state!==t)return!1;let s,c=r.bMarks[a]+r.tShift[a],o=r.eMarks[a];if("@"!==r.src.charAt(c))return!1;for(s=0;s<4;s++)if(x[s]!==r.src[c+s])return!1;const l=r.src.slice(c,c+s),d=r.src.slice(c+s,o);if(i)return!0;let b=a,p=!1;for(;b<n&&(b++,c=r.bMarks[b]+r.tShift[b],o=r.eMarks[b],!(c<o&&r.sCount[b]<r.blkIndent));)if("@"===r.src[c]&&r.sCount[b]<=r.sCount[a]){let t=!0;for(s=0;s<4;s++)if(x[s]!==r.src[c+s]){t=!1;break}if(t){p=!0;break}}const u=r.parentType,f=r.lineMax;r.parentType="tab",r.lineMax=b-(p?1:0);const k=r.push(`${t}_tab_open`,"",1),[,$,_]=/^(.*?)(?:(?<!\\)#([^#]*))?$/.exec(d.replace(/^:active/,""));k.block=!0,k.markup=l,k.info=$.trim().replace(/\\#/g,"#"),k.meta={active:d.includes(":active")},_&&(k.meta.id=_.trim()),k.map=[a,b-(p?1:0)],r.md.block.tokenize(r,a+1,b+(p?0:1));const m=r.push(`${t}_tab_close`,"",-1);return m.block=!0,m.markup="",r.parentType=u,r.lineMax=f,r.line=b+(p?0:1),!0},S=(t,e)=>(r,a,n,i)=>{let s=r.bMarks[a]+r.tShift[a],c=r.eMarks[a];if(":"!==r.src[s])return!1;let o=s+1;for(;o<=c&&":"===r.src[o];)o++;const l=o-s;if(l<3)return!1;const d=r.src.slice(s,o),b=r.src.slice(o,c),[p,u=""]=b.split("#",2);if(p.trim()!==t)return!1;if(i)return!0;let f=a,k=!1;for(;f<n&&(f++,s=r.bMarks[f]+r.tShift[f],c=r.eMarks[f],!(s<c&&r.sCount[f]<r.blkIndent));)if(":"===r.src[s]&&r.sCount[f]-r.blkIndent<4){for(o=s+1;o<=c&&":"===r.src[o];o++);if(o-s>=l&&(o=r.skipSpaces(o),o>=c)){k=!0;break}}const $=r.parentType,_=r.lineMax;r.parentType=`${t}_tabs`,r.lineMax=f-(k?1:0);const m=r.push(`${t}_tabs_open`,"",1);m.markup=d,m.block=!0,m.info=p,m.meta={id:u.trim()},m.map=[a,f-(k?1:0)];const v=e.state;e.state=t,r.md.block.tokenize(r,a+1,f-(k?1:0)),e.state=v;const h=r.push(`${t}_tabs_close`,"",-1);return h.markup=r.src.slice(s,o),h.block=!0,r.parentType=$,r.lineMax=_,r.line=f+(k?1:0),!0},C=t=>(e,r)=>{const a=[];let n=-1,i=!1,s=-1;for(let c=r;c<e.length;c++){const{block:r,meta:o,type:l,info:d}=e[c];if(r){if(l===`${t}_tabs_open`){s++;continue}if(l===`${t}_tabs_close`){if(0===s)break;s--;continue}if(s>0)continue;if(l===`${t}_tab_open`){i=!0,o.index=a.length,o.active&&(-1===n?n=a.length:o.active=!1),a.push({title:d,index:o.index,...o.id?{id:o.id}:{}});continue}if(l===`${t}_tab_close`)continue;i||(e[c].type=`${t}_tabs_empty`,e[c].hidden=!0)}}return{active:n,data:a.map(((t,e)=>({...t,active:e===n})))}},A=(t,e)=>{const{info:r,meta:a}=t[e];return{title:r,index:a.index,...a.id?{id:a.id}:{},isActive:!!a.active}},g={state:null},T=(t,e)=>{const{name:r="tabs",tabsOpenRenderer:a=(t,e,a,n,i,s)=>{const{active:c,data:o}=t,l=e[a];l.attrJoin("class",`${r}-tabs-wrapper`),l.meta.id&&l.attrJoin("data-id",l.meta.id);const d=o.map((({title:t,id:e},a)=>`<button type="button" class="${r}-tab-button${c===a?" active":""}" data-tab="${a}"${e?` data-id="${M(e)}"`:""}${c===a?" data-active":""}>${M(t)}</button>`));return`<div${s.renderAttrs(l)}>\n  <div class="${r}-tabs-header">\n    ${d.join("\n    ")}\n  </div>\n  <div class="${r}-tabs-container">\n`},tabsCloseRenderer:n=()=>"\n  </div>\n</div>",tabOpenRenderer:i=(t,e,a,n,i,s)=>{const c=e[a];return c.attrJoin("class",`${r}-tab-content${t.isActive?" active":""}`),c.attrSet("data-index",t.index.toString()),t.id&&c.attrSet("data-id",t.id.toString()),t.isActive&&c.attrJoin("data-active",""),`<div${s.renderAttrs(e[a])}>`},tabCloseRenderer:s=()=>"</div>"}=e??{},c=C(r);t.block.ruler.before("fence",`${r}_tabs`,S(r,g),{alt:["paragraph","reference","blockquote","list"]}),t.block.ruler.before("paragraph",`${r}_tab`,y(r,g),{alt:["paragraph","reference","blockquote","list"]}),t.renderer.rules[`${r}_tabs_open`]=(t,e,r,n,i)=>{const s=c(t,e);return a(s,t,e,r,n,i)},t.renderer.rules[`${r}_tabs_close`]=n,t.renderer.rules[`${r}_tab_open`]=(t,e,...r)=>{const a=A(t,e);return i(a,t,e,...r)},t.renderer.rules[`${r}_tab_close`]=s};export{T as tab};
//# sourceMappingURL=/sm/5bacb868fa353ccbf5d166f6ae9ecad129990cb424af9e90667d6cacdb76cdfc.map