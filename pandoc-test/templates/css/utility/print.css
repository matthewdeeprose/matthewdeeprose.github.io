/* ===== ENHANCED PRINT STYLES - BOOTSTRAP-INSPIRED UNIVERSAL RESET ===== */
@media print {
    /* CRITICAL: Bootstrap-style universal reset - removes ALL visual effects */
    *, *::before, *::after {
        -webkit-print-color-adjust: exact !important;
        color-adjust: exact !important;
        print-color-adjust: exact !important;
        
        /* Universal reset for print context */
        animation-duration: 0s !important;
        animation-delay: 0s !important;
        transition-duration: 0s !important;
        transition-delay: 0s !important;
        transform: none !important;
        box-shadow: none !important;
        text-shadow: none !important;
    }

    .distraction-free-controls {display: none !important;}

    /* BREAKTHROUGH FIX: Complete mjx-container reset - let MathJax handle everything */
    mjx-container, 
    mjx-container[display="true"], 
    mjx-container:not([display="true"]),
    mjx-container:hover,
    mjx-container:focus,
    mjx-container:focus-visible {
        /* Complete CSS reset - removes ALL custom styling */
        all: unset !important;
        
        /* Restore only essential display properties */
        display: revert !important;
        font-family: revert !important;
        font-size: revert !important;
        color: revert !important;
        
        /* Let MathJax's default print behavior work */
        margin: revert !important;
        padding: revert !important;
        background: revert !important;
        border: revert !important;
        
        /* Ensure page break avoidance */
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        
        /* Remove any interfering properties */
        cursor: default !important;
        border-radius: 0 !important;
        outline: none !important;
        max-width: 100% !important;
        overflow: visible !important;
    }

    /* OPTIMIZED: Document layout for printing */
    .document-wrapper {
        display: block !important;
        grid-template-columns: none !important;
        grid-template-areas: none !important;
        max-width: none !important;
        box-shadow: none !important;
        background: white !important;
    }

    /* Hide interactive elements when printing */
    .document-sidebar,
    .table-of-contents,
    .document-navigation,
    .skip-link {
        display: none !important;
    }

    /* Optimize main content for printing */
    .document-content {
        max-width: none !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        background: white !important;
        grid-area: unset !important;
        overflow: visible !important;
    }

    /* ENHANCED: Page break optimization for semantic elements */
    h1, h2, h3, h4, h5, h6 {
        page-break-after: avoid !important;
        break-after: avoid !important;
        margin-top: 1em !important;
        margin-bottom: 0.5em !important;

    }

    /* Orphans and widows optimization */
    p, li, blockquote {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        orphans: 3 !important;
        widows: 3 !important;
    }

    /* Academic content boxes */
    .definition, .theorem, .example, .proof {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        margin: 0.5em 0 !important;
        padding: 0.5em !important;

    }

    .credits-acknowledgements {
        background: white !important;
        border: 1px solid #333 !important;
        box-shadow: none !important;
        page-break-inside: avoid;
    }
    
    .credits-acknowledgements::before {
        display: none;
    }
    
    .credits-list dt {
        color: #000 !important;
        border-bottom-color: #333 !important;
    }
    
    .credits-list dd {
        color: #000 !important;
    }
    
    .credits-list a {
        color: #000 !important;
        text-decoration: underline !important;
    }

    /* List optimisation */
    ul, ol {
        margin: 0.5em 0 !important;
        padding-left: 1.5em !important;
    }

    li {
        margin-bottom: 0.2em !important;
    }

    /* Footer optimisation */
    .document-footer {
        margin-top: 2em !important;
        padding: 1em 0 !important;
        border-top: 1px solid #ccc !important;
        background: transparent !important;
        font-size: 0.8em !important;
    }

    /* ENHANCED: Force light mode CSS custom properties for ALL elements */
    :root, [data-theme="dark"] {
        --body-bg: #fff !important;
        --body-text: #000 !important;
        --link-color: #000 !important;
        --link-hover: #000 !important;
        --border-color: #333 !important;
        --heading-color: #000 !important;
        --text-secondary: #333 !important;
        --code-bg: #f5f5f5 !important;
        --surface-color: #fff !important;
        --success-color: #000 !important;
        --warning-color: #000 !important;
        --error-color: #000 !important;
        --focus-outline: #000 !important;
        --focus-bg: transparent !important;
        --sidebar-bg: #fff !important;
        --sidebar-border: #ccc !important;
        --sidebar-shadow: none !important;
    }

    /* CRITICAL: Force all elements to use light colors */
    *, *::before, *::after {
        color: #000 !important;
        background: transparent !important;
        background-color: transparent !important;
        border-color: #666 !important;
        outline-color: #000 !important;
    }

    /* Ensure good contrast for printing */
    body, .document-content {
        color: #000 !important;
        background: #fff !important;
    }

    /* Links should be readable when printed */
    a {
        color: #000 !important;
        text-decoration: underline !important;
    }

    /* Print-friendly tables */
    table {
        border-collapse: collapse !important;
        width: 100% !important;
        page-break-inside: auto !important;
    }

    tr {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
    }

    th, td {
        border: 1px solid #ccc !important;
        padding: 0.5em !important;
    }

    /* CRITICAL: Force proper page margins */
    @page {
        margin: 1in !important;
        size: letter !important;
    }

    /* Remove any custom scrollbars that might affect printing */
    ::-webkit-scrollbar {
        display: none !important;
    }
        /* ===== TITLE BLOCK PRINT OPTIMISATION ===== */
    #title-block-header {
        background: white !important;
        border: 2px solid #333 !important;
        border-radius: 0 !important;
        padding: 1.5rem 1rem 1rem !important;
        margin: 0 0 2rem 0 !important;
        text-align: center !important;
        box-shadow: none !important;
        page-break-inside: avoid !important;
        break-inside: avoid !important;
        page-break-after: avoid !important;
        break-after: avoid !important;
    }

    /* Remove decorative elements for print */
    #title-block-header::before {
        display: none !important;
    }

    /* Print-optimised title */
    #title-block-header .title {
        font-size: 1.75rem !important;
        font-weight: 700 !important;
        color: #000 !important;
        margin: 0 0 0.75rem 0 !important;
        line-height: 1.2 !important;
        letter-spacing: -0.01em !important;
    }

    /* Print-optimised author */
    #title-block-header .author {
        font-size: 1rem !important;
        font-weight: 500 !important;
        color: #333 !important;
        margin: 0 0 0.25rem 0 !important;
        line-height: 1.3 !important;
    }

    /* Print-optimised date */
    #title-block-header .date {
        font-size: 0.875rem !important;
        font-weight: 400 !important;
        color: #666 !important;
        margin: 0 !important;
        opacity: 1 !important;
    }

    /* Ensure title block doesn't break across pages */
    #title-block-header * {
        page-break-inside: avoid !important;
        break-inside: avoid !important;
    }

    /* Add some space after title block */
    #title-block-header + * {
        margin-top: 1.5rem !important;
    }

    /* Footer content hide */
    .source-viewer, .credits-acknowledgements {display:none;}
}