/*
 * Integrated A11Y Prism.js Theme for Enhanced Pandoc Exports
 * Combines light and dark themes with existing theme switching system
 * Based on: https://github.com/PrismJS/prism-themes (a11y themes)
 * @author ericwbailey (original), adapted for Enhanced Pandoc system
 */

/*
 * MARK: Setup - Common Properties
 */
@layer vendor-prism {
  @media (forced-colors: none), (forced-colors: active) {
    :root {
      --prism-a11y-border-radius: 0.3em;
      --prism-a11y-font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
      --prism-a11y-line-height: 1.5;
      --prism-a11y-code-block-margin: 0.5em 0;
      --prism-a11y-code-block-padding: 1em;
      --prism-a11y-code-inline-padding: 0.1em;
      --prism-a11y-width-border: 1px;
      --prism-a11y-width-tab: 2;
    }
  }

  /*
   * MARK: Light Theme Colors (Default)
   */
  @media (forced-colors: none), (forced-colors: active) {
    :root,
    [data-theme="light"] {
      --prism-a11y-color-background: hsla(0, 0%, 100%, 1);
      --prism-a11y-color-text-no-token: hsla(0, 0%, 33%, 1);
      --prism-a11y-color-text-comment: hsla(16, 100%, 25%, 1);
      --prism-a11y-color-text-blue: hsla(212, 55.2%, 43.7%, 1);
      --prism-a11y-color-text-cyan: hsla(192, 65.2%, 34.9%, 1);
      --prism-a11y-color-text-green: hsla(120, 100%, 25%, 1);
      --prism-a11y-color-text-gray: hsla(0, 0%, 41%, 1);
      --prism-a11y-color-text-purple: hsla(282, 100%, 41%, 1);
      --prism-a11y-color-text-red: hsla(2, 80%, 47%, 1);
      --prism-a11y-color-text-yellow: hsla(43, 74%, 30%, 1);
      --prism-a11y-plugin-color-border: hsla(43, 74%, 30%, 0.55);
      --prism-a11y-plugin-color-background: hsla(43, 74%, 30%, 0.1);
    }
  }

  /*
   * MARK: Dark Theme Colors
   */
  @media (forced-colors: none), (forced-colors: active) {
    [data-theme="dark"] {
      --prism-a11y-color-background: hsla(0, 0%, 17%, 1);
      --prism-a11y-color-text-no-token: hsla(60, 30%, 96%, 1);
      --prism-a11y-color-text-comment: hsla(54, 32%, 75%, 1);
      --prism-a11y-color-text-blue: hsla(206, 100%, 71%, 1);
      --prism-a11y-color-text-cyan: hsla(187, 77.9%, 66.3%, 1);
      --prism-a11y-color-text-green: hsla(80, 75%, 55%, 1);
      --prism-a11y-color-text-gray: hsla(60, 30%, 96%, 1);
      --prism-a11y-color-text-purple: hsla(291, 30%, 83%, 1);
      --prism-a11y-color-text-red: hsla(17, 100%, 74%, 1);
      --prism-a11y-color-text-yellow: hsla(51, 100%, 50%, 1);
      --prism-a11y-plugin-color-border: hsla(51, 100%, 50%, 0.55);
      --prism-a11y-plugin-color-background: hsla(51, 100%, 50%, 0.1);
    }
  }

  /*
   * MARK: Core Theme Styles
   */
  @media (forced-colors: none), (forced-colors: active) {
    :where(
      code[class*="language-"],
      pre[class*="language-"]
    ) {
      color: var(--prism-a11y-color-text-no-token);
      background: var(--prism-a11y-color-background);
      font-family: var(--prism-a11y-font-family);
      text-align: start;
      white-space: pre;
      word-spacing: normal;
      word-break: normal;
      word-wrap: normal;
      line-height: var(--prism-a11y-line-height);

      -moz-tab-size: var(--prism-a11y-width-tab);
      -o-tab-size: var(--prism-a11y-width-tab);
      tab-size: var(--prism-a11y-width-tab);

      -webkit-hyphens: none;
      -moz-hyphens: none;
      -ms-hyphens: none;
      hyphens: none;
    }

    /* Code blocks */
    pre[class*="language-"] {
      padding: var(--prism-a11y-code-block-padding);
      margin: var(--prism-a11y-code-block-margin);
      overflow: auto;
      border-radius: var(--prism-a11y-border-radius);
    }

    :where(
      :not(pre) > code[class*="language-"],
      pre[class*="language-"]
    ) {
      background: var(--prism-a11y-color-background);
    }

    /* Inline code */
    :not(pre) > code[class*="language-"] {
      padding: var(--prism-a11y-code-inline-padding);
      border-radius: var(--prism-a11y-border-radius);
      white-space: normal;
    }

    /*
     * MARK: Token Styling
     */
    :where(
      .token.comment,
      .token.prolog,
      .token.doctype,
      .token.cdata
    ) {
      color: var(--prism-a11y-color-text-comment);
    }

    .token.punctuation {
      color: var(--prism-a11y-color-text-gray);
    }

    :where(
      .token.property,
      .token.tag,
      .token.constant,
      .token.symbol,
      .token.deleted
    ) {
      color: var(--prism-a11y-color-text-red);
    }

    :where(
      .token.operator,
      .token.entity,
      .token.url,
      .language-css .token.string,
      .style .token.string,
      .token.variable,
      .token.keyword
    ) {
      color: var(--prism-a11y-color-text-cyan);
    }

    :where(
      .token.selector,
      .token.attr-name,
      .token.string,
      .token.char,
      .token.builtin,
      .token.inserted
    ) {
      color: var(--prism-a11y-color-text-green);
    }

    :where(
      .token.atrule,
      .token.attr-value,
      .token.function,
      .token.regex,
      .token.important
    ) {
      color: var(--prism-a11y-color-text-yellow);
    }

    :where(
      .token.boolean,
      .token.number,
      .token.keyword
    ) {
      color: var(--prism-a11y-color-text-purple);
    }

    :where(
      .token.important,
      .token.bold
    ) {
      font-weight: bold;
    }

    .token.italic {
      font-style: italic;
    }

    .token.entity {
      cursor: help;
    }

    /*
     * MARK: Plugin Support
     */
    /* Line highlight */
    .line-highlight {
      background: var(--prism-a11y-plugin-color-background);
      border-top: var(--prism-a11y-width-border) solid var(--prism-a11y-plugin-color-border);
      border-bottom: var(--prism-a11y-width-border) solid var(--prism-a11y-plugin-color-border);
    }

    /* Line numbers */
    .line-numbers .line-numbers-rows {
      border-right: var(--prism-a11y-width-border) solid var(--prism-a11y-color-text-no-token);
    }

    .line-numbers-rows > span:before {
      color: var(--prism-a11y-color-text-comment);
    }
  }

  /*
   * MARK: Source Viewer Integration
   * Styles specific to the Enhanced Pandoc source viewer component
   */
  @media (forced-colors: none), (forced-colors: active) {
    .source-viewer {
      margin: 2rem 0 1rem 0;
      border: 1px solid var(--border-color, #e1e8ec);
      border-radius: 6px;
      overflow: hidden;
      transition: border-color 0.3s ease;
    }

    .source-viewer summary {
      background: var(--surface-color, #f8f9fa);
      padding: 0.75rem 1rem;
      cursor: pointer;
      font-weight: 500;
      color: var(--body-text, #2c3e50);
      border-bottom: 1px solid var(--border-color, #e1e8ec);
      user-select: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .source-viewer summary:hover {
      background: var(--focus-bg, #ecf0f1);
    }

    /* Focus indicators for keyboard navigation */
    .source-viewer summary:focus {
      outline: 2px solid var(--focus-outline, #3498db);
      outline-offset: 2px;
      background: var(--focus-bg, #ecf0f1);
    }

    .source-viewer summary:focus-visible {
      outline: 3px solid var(--focus-outline, #3498db);
      outline-offset: 2px;
      background: var(--focus-bg, #ecf0f1);
      box-shadow: 0 0 0 1px rgba(52, 152, 219, 0.2);
    }

    /* Remove focus outline for mouse users */
    .source-viewer summary:focus:not(:focus-visible) {
      outline: none;
      box-shadow: none;
    }

    .source-viewer-indicator {
      font-size: 0.75rem;
      color: var(--text-secondary, #7f8c8d);
      font-weight: normal;
    }

    .source-viewer[open] summary {
      border-bottom: 1px solid var(--border-color, #e1e8ec);
    }

    /* Override Prism background for source viewer */
    .source-viewer pre[class*="language-"] {
      margin: 0;
      border-radius: 0;
      background: var(--prism-a11y-color-background) !important;
      position: relative;
    }

    .source-viewer code[class*="language-"] {
      background: transparent !important;
    }

    /*
     * MARK: Prism.js Toolbar and Copy Button Styling
     */
    .source-viewer .toolbar {
      padding: 1rem;
    }

    .source-viewer .toolbar-item {
      display: inline-block;
    }

    .source-viewer .copy-to-clipboard-button {
      background: var(--surface-color, #f8f9fa);
      border: 1px solid var(--border-color, #e1e8ec);
      border-radius: 4px;
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--body-text, #2c3e50);
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      font-family: inherit;
      line-height: 1.2;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .source-viewer .copy-to-clipboard-button:hover {
      background: var(--focus-bg, #ecf0f1);
      border-color: var(--focus-outline, #3498db);
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
    }

    .source-viewer .copy-to-clipboard-button:focus-visible {
      outline: 2px solid var(--focus-outline, #3498db);
      outline-offset: 2px;
    }

    .source-viewer .copy-to-clipboard-button:active {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    /* Copy button SVG icons */
    .source-viewer .copy-to-clipboard-button::before {
      content: "";
      width: 16px;
      height: 16px;
      display: inline-block;
      flex-shrink: 0;
    }

    /* Copy icon (default state) */
    .source-viewer .copy-to-clipboard-button[data-copy-state="copy"]::before {
      background-image: url("data:image/svg+xml,%3Csvg height='21' viewBox='0 0 21 21' width='21' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' transform='translate(4 3)'%3E%3Cpath d='m3.5 1.5c-.44119105-.00021714-1.03893772-.0044496-1.99754087-.00501204-.51283429-.00116132-.93645365.3838383-.99544161.88103343l-.00701752.11906336v10.99753785c.00061498.5520447.44795562.9996604 1 1.0006148l10 .0061982c.5128356.0008356.9357441-.3849039.993815-.882204l.006185-.1172316v-11c0-.55228475-.4477152-1-1-1-.8704853-.00042798-1.56475733.00021399-2 0'/%3E%3Cpath d='m4.5.5h4c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-4c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z'/%3E%3Cpath d='m2.5 5.5h5'/%3E%3Cpath d='m2.5 7.5h7'/%3E%3Cpath d='m2.5 9.5h3'/%3E%3Cpath d='m2.5 11.5h6'/%3E%3C/g%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* Success icon (copied state) */
    .source-viewer .copy-to-clipboard-button[data-copy-state="copied"]::before,
    .source-viewer .copy-to-clipboard-button[data-copy-state="copy-success"]::before {
      background-image: url("data:image/svg+xml,%3Csvg height='21' viewBox='0 0 21 21' width='21' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd' stroke='white' stroke-linecap='round' stroke-linejoin='round' transform='translate(4 3)'%3E%3Cpath d='m3.5 1.5c-.42139382 0-1.08806048 0-2 0-.55228475 0-1 .44771525-1 1v11c0 .5522848.44771525 1 1 1h10c.5522847 0 1-.4477152 1-1v-11c0-.55228475-.4477153-1-1-1-.8888889 0-1.55555556 0-2 0'/%3E%3Cpath d='m4.5.5h4c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-4c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z'/%3E%3Cpath d='m3.5 8.5 2 2 5-5'/%3E%3C/g%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* Copy button state styling */
    .source-viewer .copy-to-clipboard-button[data-copy-state="copied"],
    .source-viewer .copy-to-clipboard-button[data-copy-state="copy-success"] {
      background: var(--prism-a11y-color-text-green, #008000);
      color: white;
      border-color: var(--prism-a11y-color-text-green, #008000);
    }

    .source-viewer .copy-to-clipboard-button[data-copy-state="error"] {
      background: var(--prism-a11y-color-text-red, #dc3545);
      color: white;
      border-color: var(--prism-a11y-color-text-red, #dc3545);
    }

    .source-viewer .copy-to-clipboard-button[data-copy-state="error"]::before {
      background-image: url("data:image/svg+xml,%3Csvg height='21' viewBox='0 0 21 21' width='21' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd' stroke='white' stroke-linecap='round' stroke-linejoin='round' transform='translate(3 3)'%3E%3Cpath d='m7.5.5 7 7-7 7-7-7z'/%3E%3Cpath d='m10.5 5.5-3 3'/%3E%3Cpath d='m7.5 5.5 3 3'/%3E%3C/g%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* Dark theme adjustments for copy button */
    [data-theme="dark"] .source-viewer .copy-to-clipboard-button {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      color: var(--prism-a11y-color-text-no-token);
    }

    [data-theme="dark"] .source-viewer .copy-to-clipboard-button:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: var(--prism-a11y-color-text-cyan);
    }

    /* Dark theme SVG adjustments */
    [data-theme="dark"] .source-viewer .copy-to-clipboard-button[data-copy-state="copy"]::before {
      background-image: url("data:image/svg+xml,%3Csvg height='21' viewBox='0 0 21 21' width='21' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd' stroke='%23f5f6fa' stroke-linecap='round' stroke-linejoin='round' transform='translate(4 3)'%3E%3Cpath d='m3.5 1.5c-.44119105-.00021714-1.03893772-.0044496-1.99754087-.00501204-.51283429-.00116132-.93645365.3838383-.99544161.88103343l-.00701752.11906336v10.99753785c.00061498.5520447.44795562.9996604 1 1.0006148l10 .0061982c.5128356.0008356.9357441-.3849039.993815-.882204l.006185-.1172316v-11c0-.55228475-.4477152-1-1-1-.8704853-.00042798-1.56475733.00021399-2 0'/%3E%3Cpath d='m4.5.5h4c.55228475 0 1 .44771525 1 1s-.44771525 1-1 1h-4c-.55228475 0-1-.44771525-1-1s.44771525-1 1-1z'/%3E%3Cpath d='m2.5 5.5h5'/%3E%3Cpath d='m2.5 7.5h7'/%3E%3Cpath d='m2.5 9.5h3'/%3E%3Cpath d='m2.5 11.5h6'/%3E%3C/g%3E%3C/svg%3E");
    }

    /* Accessibility Enhancements */
    .source-viewer summary::marker,
    .source-viewer summary::-webkit-details-marker {
      display: none;
    }

    .source-viewer summary::before {
      content: '▶';
      display: inline-block;
      transition: transform 0.2s ease;
      font-size: 0.8em;
      margin-right: 0.25rem;
    }

    .source-viewer[open] summary::before {
      transform: rotate(90deg);
    }

    @media (prefers-reduced-motion: reduce) {
      .source-viewer summary::before,
      .source-viewer,
      .source-viewer summary {
        transition: none;
      }
    }
  }

  /*
   * MARK: Forced Color Mode Support
   * Ensures accessibility in Windows High Contrast mode
   */
  @media (forced-colors: active) {
    :root,
    [data-theme="light"],
    [data-theme="dark"] {
      --prism-a11y-color-background: Canvas;
      --prism-a11y-color-text-no-token: CanvasText;
      --prism-a11y-color-text-comment: GrayText;
      --prism-a11y-color-text-cyan: LinkText;
      --prism-a11y-color-text-gray: LinkText;
      --prism-a11y-color-text-green: CanvasText;
      --prism-a11y-color-text-purple: CanvasText;
      --prism-a11y-color-text-red: CanvasText;
      --prism-a11y-color-text-yellow: GrayText;
      --prism-a11y-plugin-color-border: LinkText;
      --prism-a11y-plugin-color-background: Canvas;
    }

    :where(
      .token.boolean,
      .token.number,
      .token.keyword
    ) {
      font-weight: bold;
    }

    .source-viewer {
      border: 1px solid ButtonText;
    }

    .source-viewer summary {
      background: ButtonFace;
      color: ButtonText;
      border-bottom: 1px solid ButtonText;
    }
  }
}

/* Credits and Acknowledgements Section */
.credits-acknowledgements {
  margin-top: 2rem;
  padding: 1.5rem;
  border-top: 1px solid var(--border-color);
  background: var(--surface-color);
  border-radius: 6px;
}

.credits-acknowledgements h3 {
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
  color: var(--body-text);
  font-weight: 600;
}

.credits-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  gap: 0.75rem;
}

.credits-list li {
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border-color, #e1e5e9);
}

.credits-list li:last-child {
  border-bottom: none;
}

.credits-list strong {
  color: var(--text-primary);
  display: inline-block;
  min-width: 140px;
  margin-right: 0.5rem;
}

.credits-list a {
  color: var(--link-color);
  font-weight: 500;
}

.credits-list a:hover,
.credits-list a:focus {
  text-decoration: underline;
  color: var(--link-hover);
}

.credits-list a:focus-visible {
  outline: 2px solid var(--focus-outline);
  outline-offset: 2px;
  border-radius: 2px;
}

/* Responsive credits layout */
@media (max-width: 768px) {
  .credits-list strong {
    display: block;
    min-width: auto;
    margin-bottom: 0.25rem;
  }
}

.source-viewer summary svg {
  margin-right: 0.25rem;
  vertical-align: text-bottom;
}