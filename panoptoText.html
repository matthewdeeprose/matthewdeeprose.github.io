<!DOCTYPE html>
<html lang="en-GB">
   <head>
      <meta charset="utf-8" />
      <meta name="description" content="Download text / captions from Panopto">
      <meta name="keywords" content="accessibility, presentation, blog">
      <meta name="author" content="Matthew Deeprose">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Download text / captions from Panopto</title>
      <link rel="stylesheet" id="lightCSS" href="light.css" media="(prefers-color-scheme: light)">
      <link rel="stylesheet" id="mainCSS" href="main.css" media="all">
      <link rel="stylesheet" id="darkCSS" href="dark.css" media="(prefers-color-scheme: dark)">
      <link rel="stylesheet" id="printCSS" href="print.css" media="print">
	      <link href="prism/ally-dark.css" rel="stylesheet" />
      <meta property="og:title" content="Download text / captions from Panopto - Matthew Deeprose">
      <meta property="og:description" content="Download captions or text from a Panopto video. Requires captions to have been generated first.">
      <meta property="og:image" content="https://matthewdeeprose.github.io/panoptoText43.png">
	  <meta property="og:image:width" content="2500" />
	  <meta property="og:image:height" content="1306" />
      <meta property="og:image:alt" content="">
      <meta property="og:locale" content="en_GB">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://matthewdeeprose.github.io/panoptoText.html">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="theme-color" content="#231F20" media="(prefers-color-scheme: dark)">
      <meta name="theme-color" content="#FFFFF4" media="(prefers-color-scheme: light)">
      <link rel="icon" href="favicon.ico">
      <link rel="alternate" type="application/rss+xml" title="RSS Feed for matthewdeeprose.github.io" href="https://matthewdeeprose.github.io/feed.rss">
      <link rel="icon" href="favicon.svg" type="image/svg+xml">
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="Download text / captions from Panopto - Matthew Deeprose" />
      <meta name="twitter:description" content="Download captions or text from a Panopto video. Requires captions to have been generated first. "/>
      <meta name="twitter:creator" content="@VLEguru"/>
      <meta name="twitter:site" content="@VLEguru"/>
      <meta name="twitter:image" content="https://matthewdeeprose.github.io/panoptoText43.png"/>
      <meta name="twitter:image:alt" content=""/>
      <meta name="twitter:card" content="summary_large_image"/>
	  	      <style>
         .page-wrap > * {
             grid-column: 1/-1 !important;
             grid-row: auto !important;
         }

         .demoImage {
             max-width: 70%;
         }

         @media (max-width: 768px) {
             .demoImage {
                 max-width: 100%;
             }
         }
      </style>
   </head>
   <body>
      <div class="page-wrap" id="start">
         <a class="skip-link" id="skipToContent" href='#main'>Skip to content</a>
         <header class="page-header">
            <div id="banner">
               <div id="logo">
                  <button id="modeToggle" aria-label="Change between light and dark theme" aria-pressed="false" onclick="toggle(this.id);">
                     <svg id="logoSVG" height="45" viewBox="0 0 21 21" width="45" xmlns="http://www.w3.org/2000/svg" aria-labelledby="svgTitle svgDesc" role="img">
                        <title id="svgTitle">Change theme</title>
                        <desc id="svgDesc">Select to switch to light theme</desc>
                        <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 1)">
                           <path d="m6.5 17.5h4"/>
                           <path d="m8.5 4c2.4852814 0 4.5 2.01471863 4.5 4.5 0 1.7663751-1.017722 3.2950485-2.4987786 4.031633l-.0012214.968367c0 1.1045695-.8954305 2-2 2s-2-.8954305-2-2l-.00021218-.9678653c-1.48160351-.7363918-2.49978782-2.2653584-2.49978782-4.0321347 0-2.48528137 2.01471863-4.5 4.5-4.5z"/>
                           <path d="m8.5 1.5v-1"/>
                           <path d="m13.5 3.5 1-1"/>
                           <path d="m2.5 3.5 1-1" transform="matrix(-1 0 0 1 6 0)"/>
                           <path d="m13.5 13.5 1-1" transform="matrix(1 0 0 -1 0 26)"/>
                           <path d="m2.5 13.5 1-1" transform="matrix(-1 0 0 -1 6 26)"/>
                           <path d="m1.5 7.5h-1"/>
                           <path d="m16.5 7.5h-1"/>
                        </g>
                     </svg>
                     <svg id="logoSVG-Off" height="45" viewBox="0 0 21 21" width="45" xmlns="http://www.w3.org/2000/svg" aria-labelledby="svgTitleX svgDescX">
                        <title id="svgTitleX">Change theme</title>
                        <desc id="svgDescX">Select to switch to dark theme</desc>
                        <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(6 5)">
                           <path d="m2.5 13.5h4"/>
                           <path d="m4.5 0c2.48528137 0 4.5 2.01471863 4.5 4.5 0 1.76637512-1.01772197 3.29504854-2.49877863 4.03163297l-.00122137.96836703c0 1.1045695-.8954305 2-2 2s-2-.8954305-2-2l-.00021218-.96786527c-1.48160351-.73639182-2.49978782-2.26535843-2.49978782-4.03213473 0-2.48528137 2.01471863-4.5 4.5-4.5z"/>
                        </g>
                     </svg>
                  </button>
               </div>
               <span role="alert" class="hidden" aria-live="polite" id="lightDark"></span>
               <div id="titleLink">Matthew Deeprose</div>
            </div>
         </header>
         <div id="main-navigation" class="page-nav">
            <nav aria-label="Main menu" class="topnav" id="myTopnav">
               <button id="menu" aria-controls="myTopnav" aria-labelledby="myTopnav" aria-expanded="false" class="icon"  aria-haspopup="menu" onclick="menuAction()">
                  <span id="hamburger">
                     <svg id="hamSVG" viewBox="0 0 100 80" width="20" height="20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" role="img">
                        <title id="hamSVGTitle">Menu</title>
                        <desc id="hamSVGDesc">Select to expand or collapse the menu</desc>
                        <rect width="100" height="20"></rect>
                        <rect y="30" width="100" height="20"></rect>
                        <rect y="60" width="100" height="20"></rect>
                     </svg>
                  </span>
                  <span id="arrow">
                     <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true" focusable="false">
                        <title id="arrowSVGTitle">Menu</title>
                        <desc id="arrowSVGDesc">Select to expand or collapse the menu</desc>
                        <g stroke-width="4"  stroke-linejoin="round" stroke-linecap="round" stroke="currentColor" fill-rule="evenodd" fill="none">
                           <path  d="m7.499,6.497l-3.999,4.002l4,4.001"/>
                           <path  d="m16.5,10.5l-13,0"/>
                        </g>
                     </svg>
                  </span>
               </button>
               <a id="homeMenu" href="index.html">Home</a>
               <a href="presentations.html" >Presentations</a>
               <a href="posts.html">Blog Posts</a>
               <a href="projects.html" aria-current="page" class="active">Projects</a>
               <a href="about.html">About</a>
            </nav>
         </div>
         <main class="page-main" id="main">
<article class="standard">
    <h1 id="top">Download Text / Captions from Panopto</h1>
    

    
    <h2>What Does This Tool Do?</h2>
    <script src="prism/prism.js"></script>
    <figure class="demoImage" style="aspect-ratio: 682 / 546;">
        <img class="demoImg" src="panoptoText.png" alt="Panopto video. Buttons provide download options for plain text, text with breaks, and captions files." loading="lazy">
        <figcaption class="borders">Using the tool to download captions and text from a Panopto video</figcaption>
    </figure>
    <p>This bookmarklet allows you to download captions and transcripts from Panopto videos in three different formats. When activated on a Panopto video page, it presents a dialogue with options to download clean text suitable for AI processing, text with preserved line breaks, or timestamped captions in standard SRT format.</p>
    
    <h2>How to Use</h2>
    <ol>
        <li>Select and drag the bookmarklet link below to your bookmarks bar.</li>
        <li>(In Firefox you can also right-click on the link below and select <strong>Bookmark link</strong>).</li>
        <li>Navigate to any Panopto video on southampton.cloud.panopto.eu.</li>
        <li>Click the bookmarklet from your bookmarks bar whilst viewing the video.</li>
        <li>Choose your preferred download format from the dialogue that appears.</li>
    </ol>
    <p>
        <a class="bookmarklet" href="" id="bookmarklet-link">panoptoText</a>
    </p>
    
    <h2>Why This Tool is Useful</h2>
    <p>Students often need access to video transcripts for various accessibility and learning purposes, but downloading captions from Panopto typically requires instructor permissions or navigating through multiple settings menus. This creates barriers for students who:</p>
    <ul>
        <li>Want to process transcripts with AI tools to create structured notes with headings and lists</li>
        <li>Need plain text versions for copying and pasting into documents</li>
        <li>Prefer reading transcripts rather than watching videos</li>
        <li>Require captions files for personal video editing or archival purposes</li>
        <li>Have limited time and need to quickly search through transcript content</li>
    </ul>
    <p>This bookmarklet addresses these challenges by providing immediate, one-click access to captions in multiple formats, directly from the video viewing page without requiring special permissions or technical knowledge.</p>
    
    <h2>Top Tips for Usage</h2>
    <ol class="tips">
        <li>Use the <strong>Clean Text</strong> option when you plan to paste the transcript into ChatGPT, Claude, or other AI tools to reformat it with proper headings and structure.</li>
        <li>Choose <strong>Text with Line Breaks</strong> if you want to preserve the original caption timing structure whilst removing timestamps.</li>
        <li>Select <strong>Captions with Timestamps</strong> (SRT format) if you need the file for video editing software or caption viewers.</li>
        <li>The downloaded files are automatically named using the video title, making them easy to identify in your downloads folder.</li>
        <li>You can press <kbd>Escape</kbd> to close the dialogue at any time, and keyboard navigation with <kbd>Tab</kbd> is fully supported.</li>
    </ol>
    
    <h2>What This Tool Won't Do</h2>
    <ol>
        <li>It cannot download captions from videos that don't have captions enabled or published.</li>
        <li>It will not work on Panopto videos where you don't have viewing permissions.</li>
        <li>It cannot download the actual video file itself, only the text captions and transcripts.</li>
        <li>It will not automatically format or improve the quality of auto-generated captions.</li>
        <li>It cannot create captions for videos that don't already have them.</li>
    </ol>
	
	<h2>Alternative: Console Method</h2>
<p>If you prefer not to use a bookmarklet, you can run the code directly in your browser's developer console:</p>
<ol>
    <li>Navigate to a Panopto video page</li>
    <li>Open your browser's developer console:
        <ul>
            <li>Windows/Linux: Press <kbd>F12</kbd> or <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>I</kbd></li>
            <li>Mac: Press <kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>I</kbd></li>
        </ul>
    </li>
    <li>Click on the "Console" tab</li>
    <li>Click the "Copy to Clipboard" button below</li>
    <li>Paste the code into the console and press <kbd>Enter</kbd></li>
    <li>The download dialogue will appear immediately</li>
</ol>

<details>
    <summary><strong>Show Console Code</strong></summary>
    <button id="copy-console-code" class="copy-button" type="button" aria-live="polite">
        Copy to Clipboard
    </button>
    <pre><code class="language-javascript" id="console-code">(function() {
  // Cache document and body references
  const d = document;
  const b = d.body;
  
  // Prevent multiple dialogues from opening
  if (d.getElementById('panopto-caption-dl')) {
    return;
  }
  
  // Store the currently focused element to return focus later
  let previousFocus = d.activeElement;
  
  // Create the dialogue container
  const m = d.createElement('div');
  m.id = 'panopto-caption-dl';
  m.setAttribute('role', 'dialog');
  m.setAttribute('aria-labelledby', 'panopto-dl-title');
  m.setAttribute('aria-modal', 'true');
  
  // Inject the dialogue HTML with embedded styles
  m.innerHTML = '&lt;style&gt;' +
    '#panopto-caption-dl{' +
      'position:fixed;top:50%;left:50%;' +
      'transform:translate(-50%,-50%);' +
      'background:#fffff4;' +
      'border:2px solid #00131D;' +
      'padding:20px;' +
      'z-index:999999;' +
      'box-shadow:0 4px 6px rgba(0,0,0,0.3);' +
      'max-width:500px;' +
      'font-family:sans-serif' +
    '}' +
    '#panopto-caption-dl h2{' +
      'margin:0 0 15px 0;' +
      'font-size:1.25rem;' +
      'color:#00131D' +
    '}' +
    '#panopto-caption-dl button{' +
      'display:block;width:100%;margin:10px 0;padding:12px;' +
      'font-size:1rem;background:#002E3B;color:#fff;' +
      'border:none;cursor:pointer;border-radius:4px;' +
      'text-align:left' +
    '}' +
    '#panopto-caption-dl button:hover{background:#005C84}' +
    '#panopto-caption-dl button:focus,' +
    '#panopto-caption-dl .close-btn:focus{' +
      'background:#00131D;' +
      'outline:2px transparent solid;' +
      'box-shadow:0 0 0 2px white,0 0 0 4px #002e3b,0 0 4px 8px white' +
    '}' +
    '#panopto-caption-dl button:disabled{' +
      'background:#9FB1BD;color:#231F20;cursor:not-allowed' +
    '}' +
    '#panopto-caption-dl .close-btn{' +
      'background:#00131D;color:#FCBC00;' +
      'border:1px solid #00131D;text-align:center' +
    '}' +
    '#panopto-caption-dl .close-btn:hover{' +
      'background:#FCBC00;color:#00131D;border:1px solid #00131D' +
    '}' +
    '#panopto-caption-dl .status{' +
      'margin:10px 0;padding:10px;' +
      'background:#f0f0f0;border-radius:4px;font-size:0.9rem' +
    '}' +
    '#panopto-caption-dl .btn-desc{' +
      'display:block;font-size:0.85rem;opacity:0.9;margin-top:4px' +
    '}' +
    '#panopto-caption-dl .visually-hidden{' +
      'position:absolute;width:1px;height:1px;' +
      'padding:0;margin:-1px;overflow:hidden;' +
      'clip:rect(0,0,0,0);white-space:nowrap;border:0' +
    '}' +
    '&lt;/style&gt;' +
    '&lt;h2 id="panopto-dl-title"&gt;Download Captions&lt;/h2&gt;' +
    '&lt;p class="visually-hidden"&gt;Press Escape to close this dialogue&lt;/p&gt;' +
    '&lt;div id="status-msg" class="status" style="display:none" ' +
      'role="status" aria-live="polite"&gt;&lt;/div&gt;' +
    '&lt;button id="dl-clean" type="button" ' +
      'aria-label="Download clean text - continuous text, no timestamps"&gt;' +
      'Clean Text&lt;span class="btn-desc"&gt;Continuous text, no timestamps&lt;/span&gt;' +
    '&lt;/button&gt;' +
    '&lt;button id="dl-full" type="button" ' +
      'aria-label="Download text with line breaks - original formatting preserved"&gt;' +
      'Text with Line Breaks&lt;span class="btn-desc"&gt;Original formatting preserved&lt;/span&gt;' +
    '&lt;/button&gt;' +
    '&lt;button id="dl-basic" type="button" ' +
      'aria-label="Download captions with timestamps - standard caption file format"&gt;' +
      'Captions with Timestamps&lt;span class="btn-desc"&gt;Standard caption file format&lt;/span&gt;' +
    '&lt;/button&gt;' +
    '&lt;button class="close-btn" id="close-dl" type="button" ' +
      'aria-label="Close dialogue"&gt;Close&lt;/button&gt;';
  
  // Add dialogue to page
  b.appendChild(m);
  
  // Extract video ID from URL
  const u = new URLSearchParams(window.location.search);
  const vid = u.get('id');
  
  // Check if we found a video ID
  if (!vid) {
    alert('Could not find video ID. Please ensure you are on a Panopto video page.');
    m.remove();
    if (previousFocus) previousFocus.focus();
    return;
  }
  
  // Get all focusable elements for focus trap
  const focusableEls = m.querySelectorAll('button');
  const firstFocusable = focusableEls[0];
  const lastFocusable = focusableEls[focusableEls.length - 1];
  
  // Focus trap function - keeps Tab navigation within dialogue
  const trapFocus = (e) =&gt; {
    if (e.key === 'Tab') {
      if (e.shiftKey) {
        // Shift+Tab on first element loops to last
        if (d.activeElement === firstFocusable) {
          e.preventDefault();
          lastFocusable.focus();
        }
      } else {
        // Tab on last element loops to first
        if (d.activeElement === lastFocusable) {
          e.preventDefault();
          firstFocusable.focus();
        }
      }
    }
  };
  
  // Escape key handler - closes dialogue
  const handleEscape = (e) =&gt; {
    if (e.key === 'Escape') {
      closeDialog();
    }
  };
  
  // Close dialogue and clean up
  const closeDialog = () =&gt; {
    m.removeEventListener('keydown', trapFocus);
    d.removeEventListener('keydown', handleEscape);
    m.remove();
    // Return focus to previous element
    if (previousFocus) previousFocus.focus();
  };
  
  // Build download URLs
  const host = window.location.host;
  const basicUrl = 'https://' + host + 
    '/Panopto/Pages/Transcription/GenerateSRT.ashx?id=' + vid + '&amp;language=1';
  const fullUrl = basicUrl + '&amp;full=true';
  
  // Get status message element
  const statusEl = d.getElementById('status-msg');
  
  // Extract video title from page for filename
  const getVideoTitle = () =&gt; {
    const t = d.querySelector('#primaryVideoName, .video-title, h1');
    return t ? 
      t.textContent.trim().replace(/[^a-z0-9]/gi, '_').substring(0, 50) : 
      'panopto_captions';
  };
  
  // Show status message to user
  const showStatus = (msg, isError) =&gt; {
    statusEl.textContent = msg;
    statusEl.style.display = 'block';
    statusEl.style.background = isError ? '#fee' : '#f0f0f0';
    statusEl.style.color = isError ? '#c00' : '#333';
  };
  
  // Clean transcript - removes timestamps and line numbers, joins into continuous text
  const cleanTranscript = (text) =&gt; {
    const lines = text.split('\n');
    let cleanedText = '';
    let firstLine = true;
    
    for (let line of lines) {
      line = line.trim();
      
      // Skip empty lines
      if (!line) continue;
      
      // Skip line numbers (e.g., "1", "2", "3")
      if (/^\d+$/.test(line)) continue;
      
      // Skip timestamps (e.g., "00:00:08,080 --&gt; 00:00:13,680")
      if (/^\d{2}:\d{2}:\d{2}/.test(line)) continue;
      
      // Keep disclaimer lines (e.g., "[Auto-generated transcript...]")
      if (line.startsWith('[') &amp;&amp; line.includes('transcript')) {
        cleanedText += line + '\n';
        continue;
      }
      
      // Add caption text with space separator
      if (line) {
        if (!firstLine &amp;&amp; !cleanedText.endsWith('\n')) {
          cleanedText += ' ';
        }
        cleanedText += line;
        firstLine = false;
      }
    }
    
    return cleanedText.trim();
  };
  
  // Clean with line breaks - removes timestamps but preserves paragraph structure
  const cleanWithLineBreaks = (text) =&gt; {
    const lines = text.split('\n');
    let cleanedText = '';
    let inCaptionBlock = false;
    
    for (let line of lines) {
      line = line.trim();
      
      // Empty line marks end of caption block
      if (!line) {
        if (inCaptionBlock) {
          cleanedText += '\n\n';
          inCaptionBlock = false;
        }
        continue;
      }
      
      // Skip line numbers
      if (/^\d+$/.test(line)) continue;
      
      // Skip timestamps
      if (/^\d{2}:\d{2}:\d{2}/.test(line)) continue;
      
      // Keep disclaimer with extra spacing
      if (line.startsWith('[') &amp;&amp; line.includes('transcript')) {
        cleanedText += line + '\n\n';
        continue;
      }
      
      // Add caption text with single newline
      cleanedText += line + '\n';
      inCaptionBlock = true;
    }
    
    return cleanedText.trim();
  };
  
  // Download file - fetches captions and triggers download
  const downloadFile = async (url, filename, cleanType) =&gt; {
    const btns = m.querySelectorAll('button');
    
    // Disable all buttons during download
    btns.forEach(btn =&gt; btn.disabled = true);
    showStatus('Downloading captions...');
    
    try {
      // Fetch caption data
      const resp = await fetch(url);
      if (!resp.ok) throw new Error('Download failed');
      
      let text = await resp.text();
      
      // Apply cleaning based on type
      if (cleanType === 'full') {
        text = cleanTranscript(text);
      } else if (cleanType === 'breaks') {
        text = cleanWithLineBreaks(text);
      }
      
      // Create download blob and link
      const blob = new Blob([text], { type: 'text/plain' });
      const link = d.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.style.display = 'none';
      
      // Trigger download
      b.appendChild(link);
      link.click();
      b.removeChild(link);
      URL.revokeObjectURL(link.href);
      
      // Show success message and auto-close
      showStatus('Download complete! Check your downloads folder.');
      setTimeout(closeDialog, 2000);
      
    } catch (err) {
      // Show error message
      showStatus('Error: Unable to download captions. You may not have permission.', true);
    } finally {
      // Re-enable buttons
      btns.forEach(btn =&gt; btn.disabled = false);
    }
  };
  
  // Get video title for filenames
  const videoTitle = getVideoTitle();
  
  // Set up event listeners
  m.addEventListener('keydown', trapFocus);
  d.addEventListener('keydown', handleEscape);
  
  // Wire up button click handlers
  d.getElementById('dl-clean').onclick = () =&gt; 
    downloadFile(fullUrl, videoTitle + '_clean.txt', 'full');
  
  d.getElementById('dl-full').onclick = () =&gt; 
    downloadFile(fullUrl, videoTitle + '_transcript.txt', 'breaks');
  
  d.getElementById('dl-basic').onclick = () =&gt; 
    downloadFile(basicUrl, videoTitle + '_captions.srt', null);
  
  d.getElementById('close-dl').onclick = closeDialog;
  
  // Set initial focus to first button
  firstFocusable.focus();
})();</code></pre>
</details>



<script>
    // Store the raw JavaScript code for console use
    const consoleCode = `(function(){
  const d = document, b = d.body;
  if (d.getElementById('panopto-caption-dl')) { return; }
  let previousFocus = d.activeElement;
  const m = d.createElement('div');
  m.id = 'panopto-caption-dl';
  m.setAttribute('role', 'dialog');
  m.setAttribute('aria-labelledby', 'panopto-dl-title');
  m.setAttribute('aria-modal', 'true');
  m.innerHTML = '<style>#panopto-caption-dl{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fffff4;border:2px solid #00131D;padding:20px;z-index:999999;box-shadow:0 4px 6px rgba(0,0,0,0.3);max-width:500px;font-family:sans-serif}#panopto-caption-dl h2{margin:0 0 15px 0;font-size:1.25rem;color:#00131D}#panopto-caption-dl button{display:block;width:100%;margin:10px 0;padding:12px;font-size:1rem;background:#002E3B;color:#fff;border:none;cursor:pointer;border-radius:4px;text-align:left}#panopto-caption-dl button:hover{background:#005C84}#panopto-caption-dl button:focus,#panopto-caption-dl .close-btn:focus{background:#00131D;outline:2px transparent solid;box-shadow:0 0 0 2px white,0 0 0 4px #002e3b,0 0 4px 8px white}#panopto-caption-dl button:disabled{background:#9FB1BD;color:#231F20;cursor:not-allowed}#panopto-caption-dl .close-btn{background:#00131D;color:#FCBC00;border:1px solid #00131D;text-align:center}#panopto-caption-dl .close-btn:hover{background:#FCBC00;color:#00131D;border:1px solid #00131D}#panopto-caption-dl .status{margin:10px 0;padding:10px;background:#f0f0f0;border-radius:4px;font-size:0.9rem}#panopto-caption-dl .btn-desc{display:block;font-size:0.85rem;opacity:0.9;margin-top:4px}#panopto-caption-dl .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}</style><h2 id="panopto-dl-title">Download Captions</h2><p class="visually-hidden">Press Escape to close this dialogue</p><div id="status-msg" class="status" style="display:none" role="status" aria-live="polite"></div><button id="dl-clean" type="button" aria-label="Download clean text - continuous text, no timestamps">Clean Text<span class="btn-desc">Continuous text, no timestamps</span></button><button id="dl-full" type="button" aria-label="Download text with line breaks - original formatting preserved">Text with Line Breaks<span class="btn-desc">Original formatting preserved</span></button><button id="dl-basic" type="button" aria-label="Download captions with timestamps - standard caption file format">Captions with Timestamps<span class="btn-desc">Standard caption file format</span></button><button class="close-btn" id="close-dl" type="button" aria-label="Close dialogue">Close</button>';
  b.appendChild(m);
  const u = new URLSearchParams(window.location.search), vid = u.get('id');
  if (!vid) { alert('Could not find video ID. Please ensure you are on a Panopto video page.'); m.remove(); if (previousFocus) previousFocus.focus(); return; }
  const focusableEls = m.querySelectorAll('button'), firstFocusable = focusableEls[0], lastFocusable = focusableEls[focusableEls.length - 1];
  const trapFocus = (e) => { if (e.key === 'Tab') { if (e.shiftKey) { if (d.activeElement === firstFocusable) { e.preventDefault(); lastFocusable.focus(); } } else { if (d.activeElement === lastFocusable) { e.preventDefault(); firstFocusable.focus(); } } } };
  const handleEscape = (e) => { if (e.key === 'Escape') { closeDialog(); } };
  const closeDialog = () => { m.removeEventListener('keydown', trapFocus); d.removeEventListener('keydown', handleEscape); m.remove(); if (previousFocus) previousFocus.focus(); };
  const host = window.location.host;
  const basicUrl = 'https://' + host + '/Panopto/Pages/Transcription/GenerateSRT.ashx?id=' + vid + '&language=1';
  const fullUrl = basicUrl + '&full=true';
  const statusEl = d.getElementById('status-msg');
  const getVideoTitle = () => { const t = d.querySelector('#primaryVideoName, .video-title, h1'); return t ? t.textContent.trim().replace(/[^a-z0-9]/gi, '_').substring(0, 50) : 'panopto_captions'; };
  const showStatus = (msg, isError) => { statusEl.textContent = msg; statusEl.style.display = 'block'; statusEl.style.background = isError ? '#fee' : '#f0f0f0'; statusEl.style.color = isError ? '#c00' : '#333'; };
  const cleanTranscript = (text) => { const lines = text.split('\\n'); let cleanedText = ''; let firstLine = true; for (let line of lines) { line = line.trim(); if (!line) continue; if (/^\\d+$/.test(line)) continue; if (/^\\d{2}:\\d{2}:\\d{2}/.test(line)) continue; if (line.startsWith('[') && line.includes('transcript')) { cleanedText += line + '\\n'; continue; } if (line) { if (!firstLine && !cleanedText.endsWith('\\n')) cleanedText += ' '; cleanedText += line; firstLine = false; } } return cleanedText.trim(); };
  const cleanWithLineBreaks = (text) => { const lines = text.split('\\n'); let cleanedText = ''; let inCaptionBlock = false; for (let line of lines) { line = line.trim(); if (!line) { if (inCaptionBlock) { cleanedText += '\\n\\n'; inCaptionBlock = false; } continue; } if (/^\\d+$/.test(line)) continue; if (/^\\d{2}:\\d{2}:\\d{2}/.test(line)) continue; if (line.startsWith('[') && line.includes('transcript')) { cleanedText += line + '\\n\\n'; continue; } cleanedText += line + '\\n'; inCaptionBlock = true; } return cleanedText.trim(); };
  const downloadFile = async (url, filename, cleanType) => { const btns = m.querySelectorAll('button'); btns.forEach(btn => btn.disabled = true); showStatus('Downloading captions...'); try { const resp = await fetch(url); if (!resp.ok) throw new Error('Download failed'); let text = await resp.text(); if (cleanType === 'full') text = cleanTranscript(text); else if (cleanType === 'breaks') text = cleanWithLineBreaks(text); const blob = new Blob([text], { type: 'text/plain' }), link = d.createElement('a'); link.href = URL.createObjectURL(blob); link.download = filename; link.style.display = 'none'; b.appendChild(link); link.click(); b.removeChild(link); URL.revokeObjectURL(link.href); showStatus('Download complete! Check your downloads folder.'); setTimeout(closeDialog, 2000); } catch (err) { showStatus('Error: Unable to download captions. You may not have permission.', true); } finally { btns.forEach(btn => btn.disabled = false); } };
  const videoTitle = getVideoTitle();
  m.addEventListener('keydown', trapFocus);
  d.addEventListener('keydown', handleEscape);
  d.getElementById('dl-clean').onclick = () => downloadFile(fullUrl, videoTitle + '_clean.txt', 'full');
  d.getElementById('dl-full').onclick = () => downloadFile(fullUrl, videoTitle + '_transcript.txt', 'breaks');
  d.getElementById('dl-basic').onclick = () => downloadFile(basicUrl, videoTitle + '_captions.srt', null);
  d.getElementById('close-dl').onclick = closeDialog;
  firstFocusable.focus();
})();`;

    // Generate bookmarklet code from the console code
    const bookmarkletCode = 'javascript:' + consoleCode;
    
    // Set the bookmarklet link href
    document.getElementById('bookmarklet-link').href = bookmarkletCode;
    
    // Handle copy button for console code
    document.getElementById('copy-console-code').onclick = function() {
        const button = this;
        const originalText = button.textContent;
        
        navigator.clipboard.writeText(consoleCode).then(() => {
            // Success feedback
            button.textContent = '✓ Copied!';
            button.classList.add('copied');
            button.setAttribute('aria-label', 'Code copied to clipboard');
            
            // Reset after 2 seconds
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('copied');
                button.setAttribute('aria-label', 'Copy console code to clipboard');
            }, 2000);
        }).catch(err => {
            // Error feedback
            button.textContent = '✗ Copy failed';
            console.error('Failed to copy:', err);
            
            // Reset after 2 seconds
            setTimeout(() => {
                button.textContent = originalText;
            }, 2000);
        });
    };
</script>
</article>
			      <div id="panel">
         <button class="panelButton" onclick="topFunction()" id="myBtn">
            <svg id="svgUP" height="50" viewBox="0 0 21 21" width="50" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle2 svgDesc2">
               <title id="svgTitle2">Top.</title>
               <desc id="svgDesc2">Move to the top of the page.</desc>
               <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(2 2)">
                  <circle cx="8.5" cy="8.5" r="8"/>
                  <path d="m11.5 7.5-3-3-3 3"/>
                  <path d="m8.5 4.5v8"/>
               </g>
            </svg>
            <br />
            <span id="myBtnTop" class="panelLabel">Top</span>
         </button>
         <button class="panelButton" onclick="bottomFunction()" id="myBtn2">
            <svg id="svgDOWN" height="50" viewBox="0 0 21 21" width="50" xmlns="http://www.w3.org/2000/svg" role="img" aria-labelledby="svgTitle3 svgDesc3">
               <title id="svgTitle3">Bottom.</title>
               <desc id="svgDesc3">Move to the bottom of the page.</desc>
               <g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" transform="translate(3 2)">
                  <circle cx="8.5" cy="8.5" r="8"/>
                  <path d="m5.5 9.5 3 3 3-3"/>
                  <path d="m8.5 12.5v-8"/>
               </g>
            </svg>
            <br />
            <span id="myBtnBottom" class="panelLabel">Bottom</span>
         </button>
      </div>
         </main>
         <aside class="page-sidebar related">
            <section class="related">
			<h2>Related content</h2>
			               <ul class="relUL">
                  <li><a href="contrastCompanion">Contrast Companion</a></li>
                  <li><a href="responsiveVimeoEmbed">Responsive Vimeo Embed Code Generator</a></li>
                  <li><a href="findBbAllyUnsafeHTML.html">Identify the 'unsafe html' content from an accessibility report in Blackboard</a></li>
               </ul>
			</section>

         </aside>
         <footer class="page-footer">
            <div id="RSS"><a id="rssA" href="feed.rss">RSS</a></div>
            <div id="SiteMap"><a href="siteMap.html">Site Map</a></div>
            <div id="AccessibilityFoot">
               <a href="Accessibility_Statement.html">Accessibility Statement</a>
            </div>
            <div id="twitterFoot">
               <a href="https://twitter.com/vleguru?ref_src=twsrc%5Etfw">Follow on Twitter</a>
            </div>
            <div id="YouTubeChannelFoot">
               <a href="https://www.youtube.com/channel/UCKypjo59GE79UEjoLtzKEtQ">YouTube Channel</a>
            </div>
            <div id="aboutCodePen"><a href="https://codepen.io/matthewdeeprose/">CodePen</a></div><p><div id="aboutFoot">
               <a href="https://www.linkedin.com/in/mattdeeprose/">&#169;  Matthew Deeprose</a>
            </div>
         </p></footer>
      </div>
    <script>
        // The bookmarklet code - properly structured
        const bookmarkletCode = (function() {
            const code = function() {
                const d = document, b = d.body;
                if (d.getElementById('panopto-caption-dl')) { return; }
                let previousFocus = d.activeElement;
                const m = d.createElement('div');
                m.id = 'panopto-caption-dl';
                m.setAttribute('role', 'dialog');
                m.setAttribute('aria-labelledby', 'panopto-dl-title');
                m.setAttribute('aria-modal', 'true');
                m.innerHTML = '<style>#panopto-caption-dl{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fffff4;border:2px solid #00131D;padding:20px;z-index:999999;box-shadow:0 4px 6px rgba(0,0,0,0.3);max-width:500px;font-family:sans-serif}#panopto-caption-dl h2{margin:0 0 15px 0;font-size:1.25rem;color:#00131D}#panopto-caption-dl button{display:block;width:100%;margin:10px 0;padding:12px;font-size:1rem;background:#002E3B;color:#fff;border:none;cursor:pointer;border-radius:4px;text-align:left}#panopto-caption-dl button:hover{background:#005C84}#panopto-caption-dl button:focus,#panopto-caption-dl .close-btn:focus{background:#00131D;outline:2px transparent solid;box-shadow:0 0 0 2px white,0 0 0 4px #002e3b,0 0 4px 8px white}#panopto-caption-dl button:disabled{background:#9FB1BD;color:#231F20;cursor:not-allowed}#panopto-caption-dl .close-btn{background:#00131D;color:#FCBC00;border:1px solid #00131D;text-align:center}#panopto-caption-dl .close-btn:hover{background:#FCBC00;color:#00131D;border:1px solid #00131D}#panopto-caption-dl .status{margin:10px 0;padding:10px;background:#f0f0f0;border-radius:4px;font-size:0.9rem}#panopto-caption-dl .btn-desc{display:block;font-size:0.85rem;opacity:0.9;margin-top:4px}#panopto-caption-dl .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}</style><h2 id="panopto-dl-title">Download Captions</h2><p class="visually-hidden">Press Escape to close this dialogue</p><div id="status-msg" class="status" style="display:none" role="status" aria-live="polite"></div><button id="dl-clean" type="button" aria-label="Download clean text - continuous text, no timestamps">Clean Text<span class="btn-desc">Continuous text, no timestamps</span></button><button id="dl-full" type="button" aria-label="Download text with line breaks - original formatting preserved">Text with Line Breaks<span class="btn-desc">Original formatting preserved</span></button><button id="dl-basic" type="button" aria-label="Download captions with timestamps - standard caption file format">Captions with Timestamps<span class="btn-desc">Standard caption file format</span></button><button class="close-btn" id="close-dl" type="button" aria-label="Close dialogue">Close</button>';
                b.appendChild(m);
                const u = new URLSearchParams(window.location.search), vid = u.get('id');
                if (!vid) { alert('Could not find video ID. Please ensure you are on a Panopto video page.'); m.remove(); if (previousFocus) previousFocus.focus(); return; }
                const focusableEls = m.querySelectorAll('button'), firstFocusable = focusableEls[0], lastFocusable = focusableEls[focusableEls.length - 1];
                const trapFocus = (e) => { if (e.key === 'Tab') { if (e.shiftKey) { if (d.activeElement === firstFocusable) { e.preventDefault(); lastFocusable.focus(); } } else { if (d.activeElement === lastFocusable) { e.preventDefault(); firstFocusable.focus(); } } } };
                const handleEscape = (e) => { if (e.key === 'Escape') { closeDialog(); } };
                const closeDialog = () => { m.removeEventListener('keydown', trapFocus); d.removeEventListener('keydown', handleEscape); m.remove(); if (previousFocus) previousFocus.focus(); };
                const host = window.location.host;
                const basicUrl = 'https://' + host + '/Panopto/Pages/Transcription/GenerateSRT.ashx?id=' + vid + '&language=1';
                const fullUrl = basicUrl + '&full=true';
                const statusEl = d.getElementById('status-msg');
                const getVideoTitle = () => { const t = d.querySelector('#primaryVideoName, .video-title, h1'); return t ? t.textContent.trim().replace(/[^a-z0-9]/gi, '_').substring(0, 50) : 'panopto_captions'; };
                const showStatus = (msg, isError) => { statusEl.textContent = msg; statusEl.style.display = 'block'; statusEl.style.background = isError ? '#fee' : '#f0f0f0'; statusEl.style.color = isError ? '#c00' : '#333'; };
                const cleanTranscript = (text) => { const lines = text.split('\n'); let cleanedText = ''; let firstLine = true; for (let line of lines) { line = line.trim(); if (!line) continue; if (/^\d+$/.test(line)) continue; if (/^\d{2}:\d{2}:\d{2}/.test(line)) continue; if (line.startsWith('[') && line.includes('transcript')) { cleanedText += line + '\n'; continue; } if (line) { if (!firstLine && !cleanedText.endsWith('\n')) cleanedText += ' '; cleanedText += line; firstLine = false; } } return cleanedText.trim(); };
                const downloadFile = async (url, filename, shouldClean) => { const btns = m.querySelectorAll('button'); btns.forEach(btn => btn.disabled = true); showStatus('Downloading captions...'); try { const resp = await fetch(url); if (!resp.ok) throw new Error('Download failed'); let text = await resp.text(); if (shouldClean) text = cleanTranscript(text); const blob = new Blob([text], { type: 'text/plain' }), link = d.createElement('a'); link.href = URL.createObjectURL(blob); link.download = filename; link.style.display = 'none'; b.appendChild(link); link.click(); b.removeChild(link); URL.revokeObjectURL(link.href); showStatus('Download complete! Check your downloads folder.'); setTimeout(closeDialog, 2000); } catch (err) { showStatus('Error: Unable to download captions. You may not have permission.', true); } finally { btns.forEach(btn => btn.disabled = false); } };
                const videoTitle = getVideoTitle();
                m.addEventListener('keydown', trapFocus);
                d.addEventListener('keydown', handleEscape);
                d.getElementById('dl-clean').onclick = () => downloadFile(fullUrl, videoTitle + '_clean.txt', true);
                d.getElementById('dl-full').onclick = () => downloadFile(fullUrl, videoTitle + '_transcript.txt', false);
                d.getElementById('dl-basic').onclick = () => downloadFile(basicUrl, videoTitle + '_captions.srt', false);
                d.getElementById('close-dl').onclick = closeDialog;
                firstFocusable.focus();
            };
            
            // Convert function to string and wrap in IIFE
            return 'javascript:(' + code.toString() + ')();';
        })();
        
        // Set the href attribute
        document.getElementById('bookmarklet-link').href = bookmarkletCode;
    </script>
      <script>
         function menuAction() {
             let menuSwitch = document.getElementById("myTopnav");
             if (menuSwitch.className === "topnav") {
                 menuSwitch.className += " responsive";
                 
             } else {
                 menuSwitch.className = "topnav";
             }
             let menuAriaAttrib = document.getElementById("menu").getAttribute("aria-expanded");
             if (menuAriaAttrib === "true") {
                 menuAriaAttrib = "false"
             } else {
                 menuAriaAttrib = "true"
             }
             document.getElementById("menu").setAttribute("aria-expanded", menuAriaAttrib);
         }

















      </script>
      <script>
         let mybutton = document.getElementById("myBtn");
         let mybutton2 = document.getElementById("myBtn2");
         
         
         window.onscroll = function() {
             scrollFunction()
         };
         
         function scrollFunction() {
             if (document.body.scrollTop > 660 || document.documentElement.scrollTop > 660) {
                 mybutton.style.display = "block";
         		mybutton2.style.display = "block";
             } else {
                 mybutton.style.display = "none";
         		mybutton2.style.display = "none";
             }
         }
         
         
         
         function topFunction() {
             document.body.scrollTop = 0;
             document.documentElement.scrollTop = 0; 
         document.getElementById('skipToContent').focus();
         }
         
         function bottomFunction() {
         window.scrollTo(0,document.body.scrollHeight);
         document.getElementById('rssA').focus();
         }
      </script>
      <script>
         let themePref = localStorage.getItem("theme");
         console.log("Has a theme preference been saved?", themePref);        
         
         
         function setLight() {
             let buttonStatus = document.getElementById("lightDark");
             let theButton = document.getElementById("modeToggle");
             const d = matchMedia('(prefers-color-scheme: dark)');
             let dt;
             if (d.matches) {
                 dt = 'dark';
                 console.log("Prefers dark theme in OS");
             } else {
                 dt = 'light'
                 console.log("Prefers light theme in OS");
             }
             if (dt == 'dark' && themePref == 'Dark') {
                 theButton.setAttribute("aria-pressed", "true");
             } else if (dt == 'light' && themePref == 'Dark') {
                 theButton.setAttribute("aria-pressed", "true");
             } else if (dt == 'dark' && !themePref) {
                 theButton.setAttribute("aria-pressed", "true");
             } else {
                 theButton.setAttribute("aria-pressed", "false");
             }
         }
         setLight();
         
         function toggle(btnID) {
             let buttonStatus = document.getElementById("lightDark");
             let theButton = document.getElementById(btnID);
             if (theButton.getAttribute("aria-pressed") == "true") {
                 theButton.setAttribute("aria-pressed", "false");
                 document.getElementById('lightCSS').href = 'light.css';
                 document.getElementById('darkCSS').href = 'light.css';
                 console.log("Turned on light mode");
                 localStorage.setItem("theme", "Light");
                 let themePref = localStorage.getItem("theme");
                 console.log("Site theme preference to ", themePref);
                 document.getElementById('lightDark').innerHTML = 'Light theme enabled, the button is now';
                 let toggleButton = document.getElementById('modeToggle');
                 toggleButton.removeAttribute("aria-pressed");
                 toggleButton.setAttribute("aria-pressed", "false");
             } else {
                 theButton.setAttribute("aria-pressed", "true");
                 document.getElementById('lightCSS').href = 'dark.css';
                 document.getElementById('darkCSS').href = 'dark.css';
                 console.log("Turned on dark mode");
                 localStorage.setItem("theme", "Dark");
                 let themePref = localStorage.getItem("theme");
                 console.log("Site theme preference set to ", themePref);
                 document.getElementById('lightDark').innerHTML = 'Dark theme enabled, the button is now';
                 let toggleButton = document.getElementById('modeToggle');
                 toggleButton.removeAttribute("aria-pressed");
                 toggleButton.setAttribute("aria-pressed", "true");
             }
         }
         
         function applyThemePreference() {
             if (themePref == 'Dark') {
                 let theButton = document.getElementById('modeToggle');
                 document.getElementById('lightCSS').href = 'dark.css';
                 document.getElementById('darkCSS').href = 'dark.css';
                 theButton.setAttribute("aria-pressed", "true");
                 console.log("Applied", themePref, "theme because site theme preference is set to", themePref);
             } else if (themePref == 'Light') {
                 let theButton = document.getElementById('modeToggle');
                 document.getElementById('lightCSS').href = 'light.css';
                 document.getElementById('darkCSS').href = 'light.css';
                 theButton.setAttribute("aria-pressed", "false");
                 console.log("Applied", themePref, "theme because site theme preference is set to", themePref);
             }
         }
         applyThemePreference();                
      </script>
	  <script src="scripts/lite-yt-embed.js"></script>
	  <link rel="stylesheet" href="scripts/lite-yt-embed.css"/>
	  	    <script src="scripts/jquery-3.7.1.min.js"></script>
    <script src="scripts/details.js"></script>
    <script>
      window.console || (window.console = {
        'log': alert
      });
      $(function() {
        $('html').addClass($.fn.details.support ? 'details' : 'no-details');
        $('details').details();
        $('details').on({
          'open.details': function() {
            console.log('opened')
          },
          'close.details': function() {
            console.log('closed')
          }
        })
      });
    </script>
	    <script>
      // Expand details / summary when printing
      // From https://stackoverflow.com/questions/19646684/force-open-the-details-summary-tag-for-print-in-chrome
      window.matchMedia("print").addEventListener("change", evt => {
        if (evt.matches) {
          elms = document.body.querySelectorAll("details:not([open])");
          for (e of elms) {
            e.setAttribute("open", "");
            e.dataset.wasclosed = "";
          }
        } else {
          elms = document.body.querySelectorAll("details[data-wasclosed]");
          for (e of elms) {
            e.removeAttribute("open");
            delete e.dataset.wasclosed;
          }
        }
      })
    </script>
			  <script>
document.addEventListener("DOMContentLoaded", function() {
    // Step 1: Add IDs to all heading elements without IDs
    const headings = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
    headings.forEach(heading => {
        if (!heading.id) {
            heading.id = heading.textContent.replace(/\s+/g, '');
        }
    });

    // Step 2: Create list items for each H2 in the ul with ID 'index'
    const contentsList = document.getElementById("index");
    if (contentsList) {
        const h2Elements = document.querySelectorAll("h2");
        h2Elements.forEach(h2 => {
            if (h2.textContent !== "Contents") {
                const listItem = document.createElement("li");
                const link = document.createElement("a");
                link.href = `#${h2.id}`;
                link.textContent = h2.textContent;
                listItem.appendChild(link);
                contentsList.appendChild(listItem);
            }
        });
    }
});
	  </script>


   </body>
</html>
